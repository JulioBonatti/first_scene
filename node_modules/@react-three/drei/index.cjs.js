"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),t=require("react"),r=require("react-dom/client"),n=require("three"),o=require("@react-three/fiber"),a=require("zustand"),i=require("react-merge-refs"),s=require("@react-spring/three"),c=require("@use-gesture/react"),l=require("three-stdlib"),u=require("zustand/shallow"),d=require("troika-three-text"),m=require("suspend-react"),f=require("meshline"),p=require("lodash.pick"),h=require("lodash.omit"),v=require("lodash.clamp"),g=require("stats.js"),x=require("detect-gpu"),y=require("three-mesh-bvh"),w=require("react-composer");function E(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function M(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var b=E(e),S=M(t),C=M(r),T=M(n),P=E(a),R=E(i),D=E(u),_=E(p),L=E(h),z=E(v),F=E(g),A=E(w);const k=new n.Vector3,B=new n.Vector3,U=new n.Vector3;function V(e,t,r){const n=k.setFromMatrixPosition(e.matrixWorld);n.project(t);const o=r.width/2,a=r.height/2;return[n.x*o+o,-n.y*a+a]}const I=e=>Math.abs(e)<1e-10?0:e;function O(e,t,r=""){let n="matrix3d(";for(let r=0;16!==r;r++)n+=I(t[r]*e.elements[r])+(15!==r?",":")");return r+n}const j=(W=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>O(e,W));var W;const N=(e,t)=>{return O(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},G=S.forwardRef((({children:e,eps:t=.001,style:r,className:a,prepend:i,center:s,fullscreen:c,portal:l,distanceFactor:u,sprite:d=!1,transform:m=!1,occlude:f,onOcclude:p,zIndexRange:h=[16777271,0],calculatePosition:v=V,as:g="div",wrapperClass:x,pointerEvents:y="auto",...w},E)=>{const{gl:M,camera:T,scene:P,size:R,raycaster:D,events:_}=o.useThree(),[L]=S.useState((()=>document.createElement(g))),z=S.useRef(),F=S.useRef(null),A=S.useRef(0),O=S.useRef([0,0]),W=S.useRef(null),G=S.useRef(null),H=(null==l?void 0:l.current)||_.connected||M.domElement.parentNode;S.useLayoutEffect((()=>{if(F.current){const e=z.current=C.createRoot(L);if(P.updateMatrixWorld(),m)L.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=v(F.current,T,R);L.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return H&&(i?H.prepend(L):H.appendChild(L)),()=>{H&&H.removeChild(L),e.unmount()}}}),[H,m]),S.useLayoutEffect((()=>{x&&(L.className=x)}),[x]);const $=S.useMemo((()=>m?{position:"absolute",top:0,left:0,width:R.width,height:R.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...c&&{top:-R.height/2,left:-R.width/2,width:R.width,height:R.height},...r}),[r,s,c,R,m]),q=S.useMemo((()=>({position:"absolute",pointerEvents:y})),[y]);S.useLayoutEffect((()=>{var t,n;m?null==(t=z.current)||t.render(S.createElement("div",{ref:W,style:$},S.createElement("div",{ref:G,style:q},S.createElement("div",{ref:E,className:a,style:r,children:e})))):null==(n=z.current)||n.render(S.createElement("div",{ref:E,style:$,className:a,children:e}))}));const X=S.useRef(!0);return o.useFrame((()=>{if(F.current){T.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const e=m?O.current:v(F.current,T,R);if(m||Math.abs(A.current-T.zoom)>t||Math.abs(O.current[0]-e[0])>t||Math.abs(O.current[1]-e[1])>t){const t=function(e,t){const r=k.setFromMatrixPosition(e.matrixWorld),n=B.setFromMatrixPosition(t.matrixWorld),o=r.sub(n),a=t.getWorldDirection(U);return o.angleTo(a)>Math.PI/2}(F.current,T);let r=!1;"boolean"==typeof f?!0===f&&(r=[P]):Array.isArray(f)&&(r=f.map((e=>e.current)));const o=X.current;if(r){const e=function(e,t,r,n){const o=k.setFromMatrixPosition(e.matrixWorld),a=o.clone();a.project(t),r.setFromCamera(a,t);const i=r.intersectObjects(n,!0);if(i.length){const e=i[0].distance;return o.distanceTo(r.ray.origin)<e}return!0}(F.current,T,D,r);X.current=e&&!t}else X.current=!t;if(o!==X.current&&(p?p(!X.current):L.style.display=X.current?"block":"none"),L.style.zIndex=`${function(e,t,r){if(t instanceof n.PerspectiveCamera||t instanceof n.OrthographicCamera){const n=k.setFromMatrixPosition(e.matrixWorld),o=B.setFromMatrixPosition(t.matrixWorld),a=n.distanceTo(o),i=(r[1]-r[0])/(t.far-t.near),s=r[1]-i*t.far;return Math.round(i*a+s)}}(F.current,T,h)}`,m){const[e,t]=[R.width/2,R.height/2],r=T.projectionMatrix.elements[5]*t,{isOrthographicCamera:n,top:o,left:a,bottom:i,right:s}=T,c=j(T.matrixWorldInverse),l=n?`scale(${r})translate(${I(-(s+a)/2)}px,${I((o+i)/2)}px)`:`translateZ(${r}px)`;let m=F.current.matrixWorld;d&&(m=T.matrixWorldInverse.clone().transpose().copyPosition(m).scale(F.current.scale),m.elements[3]=m.elements[7]=m.elements[11]=0,m.elements[15]=1),L.style.width=R.width+"px",L.style.height=R.height+"px",L.style.perspective=n?"":`${r}px`,W.current&&G.current&&(W.current.style.transform=`${l}${c}translate(${e}px,${t}px)`,G.current.style.transform=N(m,1/((u||10)/400)))}else{const t=void 0===u?1:function(e,t){if(t instanceof n.OrthographicCamera)return t.zoom;if(t instanceof n.PerspectiveCamera){const r=k.setFromMatrixPosition(e.matrixWorld),n=B.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,a=r.distanceTo(n);return 1/(2*Math.tan(o/2)*a)}return 1}(F.current,T)*u;L.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}O.current=e,A.current=T.zoom}}})),S.createElement("group",b.default({},w,{ref:F}))}));let H=0;const $=P.default((e=>(n.DefaultLoadingManager.onStart=(t,r,n)=>{e({active:!0,item:t,loaded:r,total:n,progress:(r-H)/(n-H)*100})},n.DefaultLoadingManager.onLoad=()=>{e({active:!1})},n.DefaultLoadingManager.onError=t=>e((e=>({errors:[...e.errors,t]}))),n.DefaultLoadingManager.onProgress=(t,r,n)=>{r===n&&(H=n),e({active:!0,item:t,loaded:r,total:n,progress:(r-H)/(n-H)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}))),q=e=>`Loading ${e.toFixed(2)}%`;const X={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}},Z=S.createContext(null);function Y(){return S.useContext(Z)}const K=S.forwardRef((({children:e},t)=>{const r=S.useRef(null),n=Y(),{width:a,height:i}=o.useThree((e=>e.viewport));return o.useFrame((()=>{r.current.position.x=n.horizontal?-a*(n.pages-1)*n.offset:0,r.current.position.y=n.horizontal?0:i*(n.pages-1)*n.offset})),S.createElement("group",{ref:R.default([t,r])},e)})),Q=S.forwardRef((({children:e,style:t,...r},n)=>{const a=Y(),i=S.useRef(null),{width:s,height:c}=o.useThree((e=>e.size)),l=S.useContext(o.context),u=S.useMemo((()=>C.createRoot(a.fixed)),[a.fixed]);return o.useFrame((()=>{a.delta>a.eps&&(i.current.style.transform=`translate3d(${a.horizontal?-s*(a.pages-1)*a.offset:0}px,${a.horizontal?0:c*(a.pages-1)*-a.offset}px,0)`)})),u.render(S.createElement("div",b.default({ref:R.default([n,i]),style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),S.createElement(Z.Provider,{value:a},S.createElement(o.context.Provider,{value:l},e)))),null})),J=S.forwardRef((({html:e,...t},r)=>{const n=e?Q:K;return S.createElement(n,b.default({ref:r},t))}));const ee=S.createContext([]);const te=S.forwardRef((function({follow:e=!0,lockX:t=!1,lockY:r=!1,lockZ:n=!1,...a},i){const s=S.useRef();return o.useFrame((({camera:o})=>{if(!e||!s.current)return;const a=s.current.rotation.clone();s.current.quaternion.copy(o.quaternion),t&&(s.current.rotation.x=a.x),r&&(s.current.rotation.y=a.y),n&&(s.current.rotation.z=a.z)})),S.createElement("group",b.default({ref:R.default([s,i])},a))})),re=S.forwardRef((function({points:e,color:t="black",vertexColors:r,linewidth:a,lineWidth:i,dashed:s,...c},u){const d=o.useThree((e=>e.size)),[m]=S.useState((()=>new l.Line2)),[f]=S.useState((()=>new l.LineMaterial)),p=S.useMemo((()=>{const t=new l.LineGeometry,o=e.map((e=>e instanceof n.Vector3?e.toArray():e));if(t.setPositions(o.flat()),r){const e=r.map((e=>e instanceof n.Color?e.toArray():e));t.setColors(e.flat())}return t}),[e,r]);return S.useLayoutEffect((()=>{m.computeLineDistances()}),[e,m]),S.useLayoutEffect((()=>{s?f.defines.USE_DASH="":delete f.defines.USE_DASH,f.needsUpdate=!0}),[s,f]),S.useEffect((()=>()=>p.dispose()),[p]),S.createElement("primitive",b.default({object:m,ref:u},c),S.createElement("primitive",{object:p,attach:"geometry"}),S.createElement("primitive",b.default({object:f,attach:"material",color:t,vertexColors:Boolean(r),resolution:[d.width,d.height],linewidth:null!=a?a:i,dashed:s},c)))})),ne=new n.Vector3,oe=S.forwardRef((function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:o=20,...a},i){const s=S.useRef(null),[c]=S.useState((()=>new n.QuadraticBezierCurve3(void 0,void 0,void 0))),l=S.useCallback(((e,t,r,o=20)=>(e instanceof n.Vector3?c.v0.copy(e):c.v0.set(...e),t instanceof n.Vector3?c.v2.copy(t):c.v2.set(...t),r instanceof n.Vector3?c.v1.copy(r):c.v1.copy(c.v0.clone().add(c.v2.clone().sub(c.v0)).add(ne.set(0,c.v0.y-c.v2.y,0))),c.getPoints(o))),[]);S.useLayoutEffect((()=>{s.current.setPoints=(e,t,r)=>{const n=l(e,t,r);s.current.geometry&&s.current.geometry.setPositions(n.map((e=>e.toArray())).flat())}}),[]);const u=S.useMemo((()=>l(e,t,r,o)),[e,t,r,o]);return S.createElement(re,b.default({ref:R.default([s,i]),points:u},a))})),ae=S.forwardRef((function({start:e,end:t,midA:r,midB:o,segments:a=20,...i},s){const c=S.useMemo((()=>{const i=e instanceof n.Vector3?e:new n.Vector3(...e),s=t instanceof n.Vector3?t:new n.Vector3(...t),c=r instanceof n.Vector3?r:new n.Vector3(...r),l=o instanceof n.Vector3?o:new n.Vector3(...o);return new n.CubicBezierCurve3(i,c,l,s).getPoints(a)}),[e,t,r,o,a]);return S.createElement(re,b.default({ref:s,points:c},i))})),ie=S.forwardRef((function({points:e,closed:t=!1,curveType:r="centripetal",tension:o=.5,segments:a=20,vertexColors:i,...s},c){const l=S.useMemo((()=>{const a=e.map((e=>e instanceof n.Vector3?e:new n.Vector3(...e)));return new n.CatmullRomCurve3(a,t,r,o)}),[e,t,r,o]),u=S.useMemo((()=>l.getPoints(a)),[l,a]),d=S.useMemo((()=>{if(!i||i.length<2)return;if(i.length===a+1)return i;const e=i.map((e=>e instanceof n.Color?e:new n.Color(...e)));t&&e.push(e[0].clone());const r=[e[0]],o=a/(e.length-1);for(let t=1;t<a;t++){const n=t%o/o,a=Math.floor(t/o);r.push(e[a].clone().lerp(e[a+1],n))}return r.push(e[e.length-1]),r}),[i,a]);return S.createElement(re,b.default({ref:c,points:u,vertexColors:d},s))})),se=S.forwardRef((({url:e,distance:t=1,loop:r=!0,autoplay:a,...i},s)=>{const c=S.useRef(),l=o.useThree((({camera:e})=>e)),[u]=S.useState((()=>new n.AudioListener)),d=o.useLoader(n.AudioLoader,e);return S.useEffect((()=>{const e=c.current;e&&(e.setBuffer(d),e.setRefDistance(t),e.setLoop(r),a&&!e.isPlaying&&e.play())}),[d,l,t,r]),S.useEffect((()=>{const e=c.current;return l.add(u),()=>{l.remove(u),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}}),[]),S.createElement("positionalAudio",b.default({ref:R.default([c,s]),args:[u]},i))})),ce=S.forwardRef((({anchorX:e="center",anchorY:t="middle",font:r,children:n,characters:a,onSync:i,...s},c)=>{const l=o.useThree((({invalidate:e})=>e)),[u]=S.useState((()=>new d.Text)),[f,p]=S.useMemo((()=>{const e=[];let t="";return S.Children.forEach(n,(r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)})),[e,t]}),[n]);return m.suspend((()=>new Promise((e=>d.preloadFont({font:r,characters:a},e)))),["troika-text",r,a]),S.useLayoutEffect((()=>{u.sync((()=>{l(),i&&i(u)}))})),S.useEffect((()=>()=>u.dispose()),[u]),S.createElement("primitive",b.default({object:u,ref:c,font:r,text:p,anchorX:e,anchorY:t},s),f)})),le=["string","number"],ue=S.forwardRef((({font:e,letterSpacing:r=0,lineHeight:n=1,size:a=1,height:i=.2,bevelThickness:s=.1,bevelSize:c=.01,bevelEnabled:u=!1,bevelOffset:d=0,bevelSegments:f=4,curveSegments:p=8,children:h,...v},g)=>{S.useMemo((()=>o.extend({RenamedTextGeometry:l.TextGeometry})),[]);const x=m.suspend((async()=>{let t="string"==typeof e?await(await fetch(e)).json():e;return(new l.FontLoader).parse(t)}),[e]),y=t.useMemo((()=>({font:x,size:a,height:i,bevelThickness:s,bevelSize:c,bevelEnabled:u,bevelSegments:f,bevelOffset:d,curveSegments:p,letterSpacing:r,lineHeight:n})),[x,a,i,s,c,u,d,p,r,n]),[w,...E]=t.useMemo((()=>(e=>{let t="";const r=[];return S.Children.forEach(e,(e=>{le.includes(typeof e)?t+=e+"":r.push(e)})),[t,...r]})(h)),[h]),M=S.useMemo((()=>[w,y]),[w,y]);return S.createElement("mesh",b.default({},v,{ref:g}),S.createElement("renamedTextGeometry",{args:M}),E)})),de=S.forwardRef((({children:e,multisamping:t=8,renderIndex:r=1,disableRender:a,disableGamma:i,disableRenderPass:s,depthBuffer:c=!0,stencilBuffer:u=!1,anisotropy:d=1,encoding:m,type:f,...p},h)=>{S.useMemo((()=>o.extend({EffectComposer:l.EffectComposer,RenderPass:l.RenderPass,ShaderPass:l.ShaderPass})),[]);const v=S.useRef(),{scene:g,camera:x,gl:y,size:w,viewport:E}=o.useThree(),[M]=S.useState((()=>{const e=new n.WebGLRenderTarget(w.width,w.height,{type:f||n.HalfFloatType,format:n.RGBAFormat,encoding:m||y.outputEncoding,depthBuffer:c,stencilBuffer:u,anisotropy:d});return e.samples=t,e}));S.useEffect((()=>{var e,t;null==(e=v.current)||e.setSize(w.width,w.height),null==(t=v.current)||t.setPixelRatio(E.dpr)}),[y,w,E.dpr]),o.useFrame((()=>{var e;a||null==(e=v.current)||e.render()}),r);const C=[];return s||C.push(S.createElement("renderPass",{key:"renderpass",attach:`passes-${C.length}`,args:[g,x]})),i||C.push(S.createElement("shaderPass",{attach:`passes-${C.length}`,key:"gammapass",args:[l.GammaCorrectionShader]})),S.Children.forEach(e,(e=>{e&&C.push(S.cloneElement(e,{key:C.length,attach:`passes-${C.length}`}))})),S.createElement("effectComposer",b.default({ref:R.default([h,v]),args:[y,M]},p),C)}));function me(e,t,r,n){const o=class extends T.ShaderMaterial{constructor(){const o=Object.entries(e);super({uniforms:o.reduce(((e,[t,r])=>({...e,...T.UniformsUtils.clone({[t]:{value:r}})})),{}),vertexShader:t,fragmentShader:r}),this.key="",o.forEach((([e])=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))),n&&n(this)}};return o.key=T.MathUtils.generateUUID(),o}const fe=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function pe(e,r){const a=o.useThree((e=>e.gl)),i=o.useLoader(n.TextureLoader,fe(e)?Object.values(e):e);if(t.useLayoutEffect((()=>{null==r||r(i)}),[r]),t.useEffect((()=>{(Array.isArray(i)?i:[i]).forEach(a.initTexture)}),[a,i]),fe(e)){const t=Object.keys(e),r={};return t.forEach((e=>Object.assign(r,{[e]:i[t.indexOf(e)]}))),r}return i}pe.preload=e=>o.useLoader.preload(n.TextureLoader,e),pe.clear=e=>o.useLoader.clear(n.TextureLoader,e);const he=me({color:new T.Color("white"),scale:[1,1],imageBounds:[1,1],map:null,zoom:1,grayscale:0,opacity:1},"\n  varying vec2 vUv;\n  void main() {\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n    vUv = uv;\n  }\n","\n  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44\n  varying vec2 vUv;\n  uniform vec2 scale;\n  uniform vec2 imageBounds;\n  uniform vec3 color;\n  uniform sampler2D map;\n  uniform float zoom;\n  uniform float grayscale;\n  uniform float opacity;\n  const vec3 luma = vec3(.299, 0.587, 0.114);\n  vec4 toGrayscale(vec4 color, float intensity) {\n    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);\n  }\n  vec2 aspect(vec2 size) {\n    return size / min(size.x, size.y);\n  }\n  void main() {\n    vec2 s = aspect(scale);\n    vec2 i = aspect(imageBounds);\n    float rs = s.x / s.y;\n    float ri = i.x / i.y;\n    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);\n    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;\n    vec2 uv = vUv * s / new + offset;\n    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);\n    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity), grayscale);\n    \n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n  }\n"),ve=S.forwardRef((({children:e,color:t,segments:r=1,scale:n=1,zoom:a=1,grayscale:i=0,opacity:s=1,texture:c,toneMapped:l,transparent:u,...d},m)=>{o.extend({ImageMaterial:he});const f=o.useThree((e=>e.gl)),p=Array.isArray(n)?[n[0],n[1]]:[n,n],h=[c.image.width,c.image.height];return S.createElement("mesh",b.default({ref:m,scale:n},d),S.createElement("planeGeometry",{args:[1,1,r,r]}),S.createElement("imageMaterial",{color:t,map:c,"map-encoding":f.outputEncoding,zoom:a,grayscale:i,opacity:s,scale:p,imageBounds:h,toneMapped:l,transparent:u}),e)})),ge=S.forwardRef((({url:e,...t},r)=>{const n=pe(e);return S.createElement(ve,b.default({},t,{texture:n,ref:r}))})),xe=S.forwardRef((({url:e,...t},r)=>S.createElement(ve,b.default({},t,{ref:r})))),ye=S.forwardRef(((e,t)=>{if(e.url)return S.createElement(ge,b.default({},e,{ref:t}));if(e.texture)return S.createElement(xe,b.default({},e,{ref:t}));throw new Error("<Image /> requires a url or texture")}));const we={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},Ee=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function Me(e,t){const{length:r,local:a,decay:i,interval:s,stride:c}={...we,...t},l=S.useRef(),[u]=S.useState((()=>new n.Vector3));S.useLayoutEffect((()=>{e&&(l.current=Float32Array.from({length:10*r*3},((t,r)=>e.position.getComponent(r%3))))}),[r,e]);const d=S.useRef(new n.Vector3),m=S.useRef(0);return o.useFrame((()=>{if(e&&l.current){if(0===m.current){let t;a?t=e.position:(e.getWorldPosition(u),t=u);const r=1*i;for(let e=0;e<r;e++)t.distanceTo(d.current)<c||(Ee(l.current,3),l.current.set(t.toArray(),l.current.length-3));d.current.copy(t)}m.current++,m.current=m.current%s}})),l}const be=S.forwardRef(((e,t)=>{const{children:r}=e,{width:a,length:i,decay:s,local:c,stride:l,interval:u}={...we,...e},{color:d="hotpink",attenuation:m,target:p}=e,h=o.useThree((e=>e.size)),v=S.useRef(null),[g,x]=S.useState(null),y=Me(g,{length:i,decay:s,local:c,stride:l,interval:u});S.useEffect((()=>{const e=(null==p?void 0:p.current)||v.current.children.find((e=>e instanceof n.Object3D));e&&x(e)}),[y,p]);const w=S.useMemo((()=>new f.MeshLine),[]),E=S.useMemo((()=>{var e;const t=new f.MeshLineMaterial({lineWidth:.1*a,color:d,sizeAttenuation:1,resolution:new n.Vector2(h.width,h.height)});let o;if(r)if(Array.isArray(r))o=r.find((e=>{const t=e;return"string"==typeof t.type&&"meshLineMaterial"===t.type}));else{const e=r;"string"==typeof e.type&&"meshLineMaterial"===e.type&&(o=e)}return"object"==typeof(null==(e=o)?void 0:e.props)&&t.setValues(o.props),t}),[a,d,h,r]);return S.useEffect((()=>{E.uniforms.resolution.value.set(h.width,h.height)}),[h]),o.useFrame((()=>{y.current&&w.setPoints(y.current,m)})),S.createElement("group",null,S.createElement("mesh",{ref:t,geometry:w,material:E}),S.createElement("group",{ref:v},r))}));function Se(e,t=16,r,o,a){const[i,s]=S.useState((()=>{const e=Array.from({length:t},(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])).flat();return new n.InstancedBufferAttribute(Float32Array.from(e),16)}));return S.useEffect((()=>{if(void 0===e.current)return;const c=new l.MeshSurfaceSampler(e.current);o&&c.setWeightAttribute(o),c.build();const u=new n.Vector3,d=new n.Vector3,m=new n.Color,f=new n.Object3D;e.current.updateMatrixWorld(!0);for(let n=0;n<t;n++)c.sample(u,d,m),"function"==typeof r?r({dummy:f,sampledMesh:e.current,position:u,normal:d,color:m},n):f.position.copy(u),f.updateMatrix(),null!=a&&a.current&&a.current.setMatrixAt(n,f.matrix),f.matrix.toArray(i.array,16*n);null!=a&&a.current&&(a.current.instanceMatrix.needsUpdate=!0),i.needsUpdate=!0,s(i.clone())}),[e,a,o,t,r]),i}function Ce(e,{keys:t=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData"],deep:r,inject:n,castShadow:o,receiveShadow:a}){let i=_.default(e,t);return r&&(i.geometry&&"materialsOnly"!==r&&(i.geometry=i.geometry.clone()),i.material&&"geometriesOnly"!==r&&(i.material=i.material.clone())),n&&(i="function"==typeof n?{...i,children:n(e)}:S.isValidElement(n)?{...i,children:n}:{...i,...n}),"Mesh"===e.type&&(o&&(i.castShadow=!0),a&&(i.receiveShadow=!0)),i}const Te=S.forwardRef((({object:e,children:t,deep:r,castShadow:n,receiveShadow:o,inject:a,keys:i,...s},c)=>{const l={keys:i,deep:r,inject:a,castShadow:n,receiveShadow:o};if(Array.isArray(e))return S.createElement("group",b.default({},s,{ref:c}),e.map((e=>S.createElement(Te,b.default({key:e.uuid,object:e},l)))),t);const{children:u,...d}=Ce(e,l),m=e.type[0].toLowerCase()+e.type.slice(1);return S.createElement(m,b.default({},d,s,{ref:c}),(null==e?void 0:e.children).map((e=>{let t={},r=e.type[0].toLowerCase()+e.type.slice(1);return"group"===r||"object3D"===r?(r=Te,t={object:e,...l}):t=Ce(e,l),S.createElement(r,b.default({key:e.uuid},t))})),t,u)})),Pe=S.createContext(null),Re=S.forwardRef((({resolution:e=28,maxPolyCount:t=1e4,enableUvs:r=!1,enableColors:a=!1,children:i,...s},c)=>{const u=S.useRef(null),d=S.useMemo((()=>new l.MarchingCubes(e,new n.MeshStandardMaterial,r,a,t)),[e,t,r,a]),m=S.useMemo((()=>({getParent:()=>u})),[]);return o.useFrame((()=>{d.reset()}),-1),S.createElement(S.Fragment,null,S.createElement("primitive",b.default({object:d,ref:R.default([u,c])},s),S.createElement(Pe.Provider,{value:m},i)))})),De=S.forwardRef((({strength:e=.5,subtract:t=12,color:r=new n.Color("#fff"),...a},i)=>{const{getParent:s}=S.useContext(Pe),c=S.useMemo((()=>s()),[s]),l=S.useRef();return o.useFrame((()=>{c.current&&l.current&&c.current.addBall(l.current.position.x,l.current.position.y,l.current.position.z,e,t,r)})),S.createElement("group",b.default({ref:R.default([i,l])},a))})),_e=S.forwardRef((({planeType:e="x",strength:t=.5,subtract:r=12,...n},a)=>{const{getParent:i}=S.useContext(Pe),s=S.useMemo((()=>i()),[i]),c=S.useRef(),l=S.useMemo((()=>"x"===e?"addPlaneX":"y"===e?"addPlaneY":"addPlaneZ"),[e]);return o.useFrame((()=>{s.current&&c.current&&s.current[l](t,r)})),S.createElement("group",b.default({ref:R.default([a,c])},n))}));function Le(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof T.Vector3||e instanceof T.Euler?[e.x,e.y,e.z]:[e,e,e]}const ze=S.forwardRef((({makeDefault:e,...t},r)=>{const n=o.useThree((({set:e})=>e)),a=o.useThree((({camera:e})=>e)),i=o.useThree((({size:e})=>e)),s=S.useRef(null);return S.useLayoutEffect((()=>{t.manual||s.current.updateProjectionMatrix()}),[i,t]),S.useLayoutEffect((()=>{s.current.updateProjectionMatrix()})),S.useLayoutEffect((()=>{if(e){const e=a;return n((()=>({camera:s.current}))),()=>n((()=>({camera:e})))}}),[s,e,n]),S.createElement("orthographicCamera",b.default({left:i.width/-2,right:i.width/2,top:i.height/2,bottom:i.height/-2,ref:R.default([s,r])},t))})),Fe=S.forwardRef((({makeDefault:e,...t},r)=>{const n=o.useThree((({set:e})=>e)),a=o.useThree((({camera:e})=>e)),i=o.useThree((({size:e})=>e)),s=S.useRef(null);return S.useLayoutEffect((()=>{t.manual||(s.current.aspect=i.width/i.height)}),[i,t]),S.useLayoutEffect((()=>{s.current.updateProjectionMatrix()})),S.useLayoutEffect((()=>{if(e){const e=a;return n((()=>({camera:s.current}))),()=>n((()=>({camera:e})))}}),[s,e,n]),S.createElement("perspectiveCamera",b.default({ref:R.default([s,r])},t))}));const Ae=S.forwardRef(((e,t)=>{const{camera:r,onChange:n,...a}=e,i=o.useThree((e=>e.camera)),s=o.useThree((e=>e.invalidate)),c=r||i,[u]=S.useState((()=>new l.DeviceOrientationControls(c)));return S.useEffect((()=>{const e=e=>{s(),n&&n(e)};return null==u||null==u.addEventListener||u.addEventListener("change",e),()=>null==u||null==u.removeEventListener?void 0:u.removeEventListener("change",e)}),[n,u,s]),o.useFrame((()=>null==u?void 0:u.update()),-1),S.useEffect((()=>{const e=u;return null==e||e.connect(),()=>null==e?void 0:e.dispose()}),[u]),u?S.createElement("primitive",b.default({ref:t,object:u},a)):null})),ke=S.forwardRef((({domElement:e,...t},r)=>{const{onChange:n,...a}=t,i=o.useThree((e=>e.invalidate)),s=o.useThree((e=>e.camera)),c=o.useThree((e=>e.gl)),u=o.useThree((e=>e.events)),d=e||u.connected||c.domElement,[m]=S.useState((()=>new l.FlyControls(s,d)));return S.useEffect((()=>{const e=e=>{i(),n&&n(e)};return null==m||null==m.addEventListener||m.addEventListener("change",e),()=>null==m||null==m.removeEventListener?void 0:m.removeEventListener("change",e)}),[n,m,i]),o.useFrame(((e,t)=>null==m?void 0:m.update(t))),m?S.createElement("primitive",b.default({ref:r,object:m},a)):null})),Be=S.forwardRef(((e={enableDamping:!0},t)=>{const{domElement:r,camera:n,makeDefault:a,onChange:i,onStart:s,onEnd:c,...u}=e,d=o.useThree((e=>e.invalidate)),m=o.useThree((e=>e.camera)),f=o.useThree((e=>e.gl)),p=o.useThree((e=>e.events)),h=o.useThree((e=>e.set)),v=o.useThree((e=>e.get)),g=r||p.connected||f.domElement,x=n||m,y=S.useMemo((()=>new l.MapControls(x)),[x]);return S.useEffect((()=>{y.connect(g);const e=e=>{d(),i&&i(e)};return y.addEventListener("change",e),s&&y.addEventListener("start",s),c&&y.addEventListener("end",c),()=>{y.dispose(),y.removeEventListener("change",e),s&&y.removeEventListener("start",s),c&&y.removeEventListener("end",c)}}),[i,s,c,y,d,g]),S.useEffect((()=>{if(a){const e=v().controls;return h({controls:y}),()=>h({controls:e})}}),[a,y]),o.useFrame((()=>y.update()),-1),S.createElement("primitive",b.default({ref:t,object:y,enableDamping:!0},u))})),Ue=S.forwardRef((({makeDefault:e,camera:t,regress:r,domElement:n,enableDamping:a=!0,onChange:i,onStart:s,onEnd:c,...u},d)=>{const m=o.useThree((e=>e.invalidate)),f=o.useThree((e=>e.camera)),p=o.useThree((e=>e.gl)),h=o.useThree((e=>e.events)),v=o.useThree((e=>e.set)),g=o.useThree((e=>e.get)),x=o.useThree((e=>e.performance)),y=t||f,w=n||h.connected||p.domElement,E=S.useMemo((()=>new l.OrbitControls(y)),[y]);return o.useFrame((()=>{E.enabled&&E.update()}),-1),S.useEffect((()=>(E.connect(w),()=>{E.dispose()})),[w,r,E,m]),S.useEffect((()=>{const e=e=>{m(),r&&x.regress(),i&&i(e)};return E.addEventListener("change",e),s&&E.addEventListener("start",s),c&&E.addEventListener("end",c),()=>{s&&E.removeEventListener("start",s),c&&E.removeEventListener("end",c),E.removeEventListener("change",e)}}),[i,s,c,E,m]),S.useEffect((()=>{if(e){const e=g().controls;return v({controls:E}),()=>v({controls:e})}}),[e,E]),S.createElement("primitive",b.default({ref:d,object:E,enableDamping:a},u))})),Ve=S.forwardRef((({makeDefault:e,camera:t,domElement:r,regress:n,onChange:a,onStart:i,onEnd:s,...c},u)=>{const{invalidate:d,camera:m,gl:f,events:p,set:h,get:v,performance:g,viewport:x}=o.useThree(),y=t||m,w=r||p.connected||f.domElement,E=S.useMemo((()=>new l.TrackballControls(y)),[y]);return o.useFrame((()=>{E.enabled&&E.update()}),-1),S.useEffect((()=>(E.connect(w),()=>{E.dispose()})),[w,n,E,d]),S.useEffect((()=>{const e=e=>{d(),n&&g.regress(),a&&a(e)};return E.addEventListener("change",e),i&&E.addEventListener("start",i),s&&E.addEventListener("end",s),()=>{i&&E.removeEventListener("start",i),s&&E.removeEventListener("end",s),E.removeEventListener("change",e)}}),[a,i,s,E,d]),S.useEffect((()=>{E.handleResize()}),[x]),S.useEffect((()=>{if(e){const e=v().controls;return h({controls:E}),()=>h({controls:e})}}),[e,E]),S.createElement("primitive",b.default({ref:u,object:E},c))})),Ie=t.forwardRef((({camera:e,makeDefault:r,regress:n,domElement:a,onChange:i,onStart:s,onEnd:c,...u},d)=>{const m=o.useThree((e=>e.invalidate)),f=o.useThree((e=>e.camera)),p=o.useThree((e=>e.gl)),h=o.useThree((e=>e.events)),v=o.useThree((e=>e.set)),g=o.useThree((e=>e.get)),x=o.useThree((e=>e.performance)),y=e||f,w=a||h.connected||p.domElement,E=t.useMemo((()=>new l.ArcballControls(y)),[y]);return o.useFrame((()=>{E.enabled&&E.update()}),-1),t.useEffect((()=>(E.connect(w),()=>{E.dispose()})),[w,n,E,m]),t.useEffect((()=>{const e=e=>{m(),n&&x.regress(),i&&i(e)};return E.addEventListener("change",e),s&&E.addEventListener("start",s),c&&E.addEventListener("end",c),()=>{E.removeEventListener("change",e),s&&E.removeEventListener("start",s),c&&E.removeEventListener("end",c)}}),[i,s,c]),t.useEffect((()=>{if(r){const e=g().controls;return v({controls:E}),()=>v({controls:e})}}),[r,E]),S.createElement("primitive",b.default({ref:d,object:E},u))})),Oe=S.forwardRef((({children:e,domElement:t,onChange:r,onMouseDown:n,onMouseUp:a,onObjectChange:i,object:s,...c},u)=>{const d=["enabled","axis","mode","translationSnap","rotationSnap","scaleSnap","space","size","showX","showY","showZ"],{camera:m,...f}=c,p=_.default(f,d),h=L.default(f,d),v=o.useThree((e=>e.controls)),g=o.useThree((e=>e.gl)),x=o.useThree((e=>e.events)),y=o.useThree((e=>e.camera)),w=o.useThree((e=>e.invalidate)),E=m||y,M=t||x.connected||g.domElement,C=S.useMemo((()=>new l.TransformControls(E,M)),[E,M]),P=S.useRef();return S.useLayoutEffect((()=>(s?C.attach(s instanceof T.Object3D?s:s.current):P.current instanceof T.Object3D&&C.attach(P.current),()=>{C.detach()})),[s,e,C]),S.useEffect((()=>{if(v){const e=e=>v.enabled=!e.value;return C.addEventListener("dragging-changed",e),()=>C.removeEventListener("dragging-changed",e)}}),[C,v]),S.useEffect((()=>{const e=e=>{w(),r&&r(e)};return null==C||null==C.addEventListener||C.addEventListener("change",e),n&&(null==C||null==C.addEventListener||C.addEventListener("mouseDown",n)),a&&(null==C||null==C.addEventListener||C.addEventListener("mouseUp",a)),i&&(null==C||null==C.addEventListener||C.addEventListener("objectChange",i)),()=>{null==C||null==C.removeEventListener||C.removeEventListener("change",e),n&&(null==C||null==C.removeEventListener||C.removeEventListener("mouseDown",n)),a&&(null==C||null==C.removeEventListener||C.removeEventListener("mouseUp",a)),i&&(null==C||null==C.removeEventListener||C.removeEventListener("objectChange",i))}}),[r,n,a,i,C,w]),C?S.createElement(S.Fragment,null,S.createElement("primitive",b.default({ref:u,object:C},p)),S.createElement("group",b.default({ref:P},h),e)):null})),je=S.forwardRef((({domElement:e,selector:t,onChange:r,onLock:n,onUnlock:a,enabled:i=!0,...s},c)=>{const{camera:u,...d}=s,m=o.useThree((e=>e.get)),f=o.useThree((e=>e.setEvents)),p=o.useThree((e=>e.gl)),h=o.useThree((e=>e.camera)),v=o.useThree((e=>e.invalidate)),g=o.useThree((e=>e.events)),x=u||h,y=e||g.connected||p.domElement,[w]=S.useState((()=>new l.PointerLockControls(x)));return S.useEffect((()=>{if(i){w.connect(y);const e=m().events.compute;return f({compute(e,t){const r=t.size.width/2,n=t.size.height/2;t.pointer.set(r/t.size.width*2-1,-n/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{w.disconnect(),f({compute:e})}}}),[i,w]),S.useEffect((()=>{const e=e=>{v(),r&&r(e)};w.addEventListener("change",e),n&&w.addEventListener("lock",n),a&&w.addEventListener("unlock",a);const o=()=>w.lock(),i=t?Array.from(document.querySelectorAll(t)):[document];return i.forEach((e=>e&&e.addEventListener("click",o))),()=>{w.removeEventListener("change",e),n&&w.addEventListener("lock",n),a&&w.addEventListener("unlock",a),i.forEach((e=>e?e.removeEventListener("click",o):void 0))}}),[r,n,a,t,w,v]),S.createElement("primitive",b.default({ref:c,object:w},d))})),We=S.forwardRef((({domElement:e,...t},r)=>{const n=o.useThree((e=>e.camera)),a=o.useThree((e=>e.gl)),i=o.useThree((e=>e.events)),s=e||i.connected||a.domElement,[c]=S.useState((()=>new l.FirstPersonControls(n,s)));return o.useFrame(((e,t)=>{c.update(t)}),-1),c?S.createElement("primitive",b.default({ref:r,object:c},t)):null})),Ne=S.createContext(null),Ge=new T.Vector3,He=new T.Vector3,$e=new T.Vector3(0,1,0),qe=new T.Matrix4,Xe=({direction:e,axis:t})=>{const{translation:r,translationLimits:n,annotationsClass:a,depthTest:i,scale:s,lineWidth:c,fixed:l,axisColors:u,hoveredColor:d,displayValues:m,opacity:f,onDragStart:p,onDrag:h,onDragEnd:v,userData:g}=S.useContext(Ne),x=o.useThree((e=>e.controls)),y=S.useRef(null),w=S.useRef(null),E=S.useRef(null),M=S.useRef(0),[b,C]=S.useState(!1),P=S.useCallback((n=>{m&&(y.current.innerText=`${r.current[t].toFixed(2)}`,y.current.style.display="block"),n.stopPropagation();const o=(new T.Matrix4).extractRotation(w.current.matrixWorld),a=n.point.clone(),i=e.clone().applyMatrix4(o).normalize();E.current={clickPoint:a,dir:i},M.current=r.current[t],p(),x&&(x.enabled=!1),n.target.setPointerCapture(n.pointerId)}),[e,x,p,r,t]),R=S.useCallback((e=>{if(e.stopPropagation(),b||C(!0),E.current){const{clickPoint:o,dir:a}=E.current,[i,s]=(null==n?void 0:n[t])||[void 0,void 0];let c=((e,t,r,n)=>{const o=t.dot(t),a=t.dot(e)-t.dot(r),i=t.dot(n);return 0===i?-a/o:(Ge.copy(n).multiplyScalar(o/i).sub(t),He.copy(n).multiplyScalar(a/i).add(r).sub(e),-Ge.dot(He)/Ge.dot(Ge))})(o,a,e.ray.origin,e.ray.direction);void 0!==i&&(c=Math.max(c,i-M.current)),void 0!==s&&(c=Math.min(c,s-M.current)),r.current[t]=M.current+c,m&&(y.current.innerText=`${r.current[t].toFixed(2)}`),qe.makeTranslation(a.x*c,a.y*c,a.z*c),h(qe)}}),[h,b,r,n,t]),D=S.useCallback((e=>{m&&(y.current.style.display="none"),e.stopPropagation(),E.current=null,v(),x&&(x.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[x,v]),_=S.useCallback((e=>{e.stopPropagation(),C(!1)}),[]),{cylinderLength:L,coneWidth:z,coneLength:F,matrixL:A}=S.useMemo((()=>{const t=l?c/s*1.6:s/20,r=l?.2:s/5,n=l?1-r:s-r,o=(new T.Quaternion).setFromUnitVectors($e,e.clone().normalize());return{cylinderLength:n,coneWidth:t,coneLength:r,matrixL:(new T.Matrix4).makeRotationFromQuaternion(o)}}),[e,s,c,l]),k=b?d:u[t];return S.createElement("group",{ref:w},S.createElement("group",{matrix:A,matrixAutoUpdate:!1,onPointerDown:P,onPointerMove:R,onPointerUp:D,onPointerOut:_},S.createElement(G,{position:[0,-F,0]},S.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),S.createElement("mesh",{visible:!1,position:[0,(L+F)/2,0],userData:g},S.createElement("cylinderGeometry",{args:[1.4*z,1.4*z,L+F,8,1]})),S.createElement(re,{transparent:!0,raycast:()=>null,depthTest:i,points:[0,0,0,0,L,0],lineWidth:c,color:k,opacity:f,polygonOffset:!0,renderOrder:1,polygonOffsetFactor:-10}),S.createElement("mesh",{raycast:()=>null,position:[0,L+F/2,0],renderOrder:500},S.createElement("coneGeometry",{args:[z,F,24,1]}),S.createElement("meshBasicMaterial",{transparent:!0,depthTest:i,color:k,opacity:f,polygonOffset:!0,polygonOffsetFactor:-10}))))},Ze=new T.Ray,Ye=new T.Vector3,Ke=new T.Matrix4,Qe=({dir1:e,dir2:t,axis:r})=>{const{translation:n,translationLimits:a,annotationsClass:i,depthTest:s,scale:c,lineWidth:l,fixed:u,axisColors:d,hoveredColor:m,displayValues:f,opacity:p,onDragStart:h,onDrag:v,onDragEnd:g,userData:x}=S.useContext(Ne),y=o.useThree((e=>e.controls)),w=S.useRef(null),E=S.useRef(null),M=S.useRef(null),b=S.useRef(0),C=S.useRef(0),[P,R]=S.useState(!1),D=S.useCallback((e=>{f&&(w.current.innerText=`${n.current[(r+1)%3].toFixed(2)}, ${n.current[(r+2)%3].toFixed(2)}`,w.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),o=(new T.Vector3).setFromMatrixPosition(E.current.matrixWorld),a=(new T.Vector3).setFromMatrixColumn(E.current.matrixWorld,0).normalize(),i=(new T.Vector3).setFromMatrixColumn(E.current.matrixWorld,1).normalize(),s=(new T.Vector3).setFromMatrixColumn(E.current.matrixWorld,2).normalize(),c=(new T.Plane).setFromNormalAndCoplanarPoint(s,o);M.current={clickPoint:t,e1:a,e2:i,plane:c},b.current=n.current[(r+1)%3],C.current=n.current[(r+2)%3],h(),y&&(y.enabled=!1),e.target.setPointerCapture(e.pointerId)}),[y,h]),_=S.useCallback((e=>{if(e.stopPropagation(),P||R(!0),M.current){const{clickPoint:t,e1:o,e2:i,plane:s}=M.current,[c,l]=(null==a?void 0:a[(r+1)%3])||[void 0,void 0],[u,d]=(null==a?void 0:a[(r+2)%3])||[void 0,void 0];Ze.copy(e.ray),Ze.intersectPlane(s,Ye),Ze.direction.negate(),Ze.intersectPlane(s,Ye),Ye.sub(t);let[m,p]=((e,t,r)=>{const n=Math.abs(e.x)>=Math.abs(e.y)&&Math.abs(e.x)>=Math.abs(e.z)?0:Math.abs(e.y)>=Math.abs(e.x)&&Math.abs(e.y)>=Math.abs(e.z)?1:2,o=[0,1,2].sort(((e,r)=>Math.abs(t.getComponent(r))-Math.abs(t.getComponent(e)))),a=n===o[0]?o[1]:o[0],i=e.getComponent(n),s=e.getComponent(a),c=t.getComponent(n),l=t.getComponent(a),u=r.getComponent(n),d=(r.getComponent(a)-u*(s/i))/(l-c*(s/i));return[(u-d*c)/i,d]})(o,i,Ye);void 0!==c&&(m=Math.max(m,c-b.current)),void 0!==l&&(m=Math.min(m,l-b.current)),void 0!==u&&(p=Math.max(p,u-C.current)),void 0!==d&&(p=Math.min(p,d-C.current)),n.current[(r+1)%3]=b.current+m,n.current[(r+2)%3]=C.current+p,f&&(w.current.innerText=`${n.current[(r+1)%3].toFixed(2)}, ${n.current[(r+2)%3].toFixed(2)}`),Ke.makeTranslation(m*o.x+p*i.x,m*o.y+p*i.y,m*o.z+p*i.z),v(Ke)}}),[v,P,n,a,r]),L=S.useCallback((e=>{f&&(w.current.style.display="none"),e.stopPropagation(),M.current=null,g(),y&&(y.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[y,g]),z=S.useCallback((e=>{e.stopPropagation(),R(!1)}),[]),F=S.useMemo((()=>{const r=e.clone().normalize(),n=t.clone().normalize();return(new T.Matrix4).makeBasis(r,n,r.clone().cross(n))}),[e,t]),A=u?1/7:c/7,k=u?.225:.225*c,B=P?m:d[r],U=S.useMemo((()=>[new T.Vector3(0,0,0),new T.Vector3(0,k,0),new T.Vector3(k,k,0),new T.Vector3(k,0,0),new T.Vector3(0,0,0)]),[k]);return S.createElement("group",{ref:E,matrix:F,matrixAutoUpdate:!1},S.createElement(G,{position:[0,0,0]},S.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:i,ref:w})),S.createElement("group",{position:[1.7*A,1.7*A,0]},S.createElement("mesh",{visible:!0,onPointerDown:D,onPointerMove:_,onPointerUp:L,onPointerOut:z,scale:k,userData:x},S.createElement("planeGeometry",null),S.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:B,polygonOffset:!0,polygonOffsetFactor:-10,side:T.DoubleSide})),S.createElement(re,{position:[-k/2,-k/2,0],transparent:!0,depthTest:s,points:U,lineWidth:l,color:B,opacity:p,polygonOffset:!0,polygonOffsetFactor:-10,userData:x})))},Je=new T.Vector3,et=new T.Vector3,tt=e=>180*e/Math.PI,rt=e=>{let t=((e,t)=>{let r=Math.floor(e/t);return r=r<0?r+1:r,e-r*t})(e,2*Math.PI);return Math.abs(t)<1e-6?0:(t<0&&(t+=2*Math.PI),t)},nt=new T.Matrix4,ot=new T.Vector3,at=new T.Ray,it=new T.Vector3,st=({dir1:e,dir2:t,axis:r})=>{const{rotationLimits:n,annotationsClass:a,depthTest:i,scale:s,lineWidth:c,fixed:l,axisColors:u,hoveredColor:d,displayValues:m,opacity:f,onDragStart:p,onDrag:h,onDragEnd:v,userData:g}=S.useContext(Ne),x=o.useThree((e=>e.controls)),y=S.useRef(null),w=S.useRef(null),E=S.useRef(0),M=S.useRef(0),b=S.useRef(null),[C,P]=S.useState(!1),R=S.useCallback((e=>{m&&(y.current.innerText=`${tt(M.current).toFixed(0)}º`,y.current.style.display="block"),e.stopPropagation();const t=e.point.clone(),r=(new T.Vector3).setFromMatrixPosition(w.current.matrixWorld),n=(new T.Vector3).setFromMatrixColumn(w.current.matrixWorld,0).normalize(),o=(new T.Vector3).setFromMatrixColumn(w.current.matrixWorld,1).normalize(),a=(new T.Vector3).setFromMatrixColumn(w.current.matrixWorld,2).normalize(),i=(new T.Plane).setFromNormalAndCoplanarPoint(a,r);b.current={clickPoint:t,origin:r,e1:n,e2:o,normal:a,plane:i},p(),x&&(x.enabled=!1),e.target.setPointerCapture(e.pointerId)}),[x,p]),D=S.useCallback((e=>{if(e.stopPropagation(),C||P(!0),b.current){const{clickPoint:t,origin:o,e1:a,e2:i,normal:s,plane:c}=b.current,[l,u]=(null==n?void 0:n[r])||[void 0,void 0];at.copy(e.ray),at.intersectPlane(c,it),at.direction.negate(),at.intersectPlane(c,it);let d=((e,t,r,n,o)=>{Je.copy(e).sub(r),et.copy(t).sub(r);const a=n.dot(n),i=o.dot(o),s=Je.dot(n)/a,c=Je.dot(o)/i,l=et.dot(n)/a,u=et.dot(o)/i,d=Math.atan2(c,s);return Math.atan2(u,l)-d})(t,it,o,a,i),f=tt(d);e.shiftKey&&(f=10*Math.round(f/10),d=(e=>e*Math.PI/180)(f)),void 0!==l&&void 0!==u&&u-l<2*Math.PI?(d=rt(d),d=d>Math.PI?d-2*Math.PI:d,d=z.default(d,l-E.current,u-E.current),M.current=E.current+d):(M.current=rt(E.current+d),M.current=M.current>Math.PI?M.current-2*Math.PI:M.current),m&&(f=tt(M.current),y.current.innerText=`${f.toFixed(0)}º`),nt.makeRotationAxis(s,d),ot.copy(o).applyMatrix4(nt).sub(o).negate(),nt.setPosition(ot),h(nt)}}),[h,C,n,r]),_=S.useCallback((e=>{m&&(y.current.style.display="none"),e.stopPropagation(),E.current=M.current,b.current=null,v(),x&&(x.enabled=!0),e.target.releasePointerCapture(e.pointerId)}),[x,v]),L=S.useCallback((e=>{e.stopPropagation(),P(!1)}),[]),F=S.useMemo((()=>{const r=e.clone().normalize(),n=t.clone().normalize();return(new T.Matrix4).makeBasis(r,n,r.clone().cross(n))}),[e,t]),A=l?.65:.65*s,k=S.useMemo((()=>{const e=[];for(let t=0;t<=32;t++){const r=t*(Math.PI/2)/32;e.push(new T.Vector3(Math.cos(r)*A,Math.sin(r)*A,0))}return e}),[A]);return S.createElement("group",{ref:w,onPointerDown:R,onPointerMove:D,onPointerUp:_,onPointerOut:L,matrix:F,matrixAutoUpdate:!1},S.createElement(G,{position:[A,A,0]},S.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),S.createElement(re,{points:k,lineWidth:4*c,visible:!1,userData:g}),S.createElement(re,{transparent:!0,raycast:()=>null,depthTest:i,points:k,lineWidth:c,color:C?d:u[r],opacity:f,polygonOffset:!0,polygonOffsetFactor:-10}))},ct=new T.Vector3,lt=new T.Vector3,ut=new T.Vector3,dt=(e,t,r,n=1)=>{const o=ct.set(e.x/r.width*2-1,-e.y/r.height*2+1,n);return o.unproject(t),o},mt=(e,t,r,n)=>{const o=((e,t,r)=>{const n=r.width/2,o=r.height/2;t.updateMatrixWorld(!1);const a=e.project(t);return a.x=a.x*n+n,a.y=-a.y*o+o,a})(ut.copy(e),r,n);let a=0;for(let i=0;i<2;++i){const s=lt.copy(o).setComponent(i,o.getComponent(i)+t),c=dt(s,r,n,s.z);a=Math.max(a,e.distanceTo(c))}return a},ft=new T.Matrix4,pt=new T.Matrix4,ht=new T.Matrix4,vt=new T.Matrix4,gt=new T.Matrix4,xt=new T.Matrix4,yt=new T.Matrix4,wt=new T.Matrix4,Et=new T.Box3,Mt=new T.Box3,bt=new T.Vector3,St=new T.Vector3,Ct=new T.Vector3,Tt=new T.Vector3,Pt=new T.Vector3(1,0,0),Rt=new T.Vector3(0,1,0),Dt=new T.Vector3(0,0,1),_t=S.forwardRef((({matrix:e,onDragStart:t,onDrag:r,onDragEnd:n,autoTransform:a=!0,anchor:i,disableAxes:s=!1,disableSliders:c=!1,disableRotations:l=!1,activeAxes:u=[!0,!0,!0],offset:d=[0,0,0],rotation:m=[0,0,0],scale:p=1,lineWidth:h=4,fixed:v=!1,translationLimits:g,rotationLimits:x,depthTest:y=!0,axisColors:w=["#ff2060","#20df80","#2080ff"],hoveredColor:E="#ffff40",displayValues:M=!0,opacity:b=1,visible:C=!0,userData:P,children:R},D)=>{o.extend({MeshLine:f.MeshLine,MeshLineMaterial:f.MeshLineMaterial});const _=o.useThree((e=>e.invalidate)),L=S.useRef(null),z=S.useRef(null),F=S.useRef(null),A=S.useRef(null),k=S.useRef([0,0,0]);S.useLayoutEffect((()=>{i&&(A.current.updateWorldMatrix(!0,!0),vt.copy(A.current.matrixWorld).invert(),Et.makeEmpty(),A.current.traverse((e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),xt.copy(e.matrixWorld).premultiply(vt),Mt.copy(e.geometry.boundingBox),Mt.applyMatrix4(xt),Et.union(Mt))})),bt.copy(Et.max).add(Et.min).multiplyScalar(.5),St.copy(Et.max).sub(Et.min).multiplyScalar(.5),Ct.copy(St).multiply(new T.Vector3(...i)).add(bt),Tt.set(...d).add(Ct),F.current.position.copy(Tt),_())}));const B=S.useMemo((()=>({onDragStart:()=>{ft.copy(z.current.matrix),pt.copy(z.current.matrixWorld),t&&t(),_()},onDrag:e=>{ht.copy(L.current.matrixWorld),vt.copy(ht).invert(),gt.copy(pt).premultiply(e),xt.copy(gt).premultiply(vt),yt.copy(ft).invert(),wt.copy(xt).multiply(yt),a&&z.current.matrix.copy(xt),r&&r(xt,wt,gt,e),_()},onDragEnd:()=>{n&&n(),_()},translation:k,translationLimits:g,rotationLimits:x,axisColors:w,hoveredColor:E,opacity:b,scale:p,lineWidth:h,fixed:v,displayValues:M,depthTest:y,userData:P})),[t,r,n,k,g,x,y,p,h,v,...w,E,b,M,P,a]),U=new T.Vector3;return o.useFrame((e=>{if(v){const o=mt(F.current.getWorldPosition(U),p,e.camera,e.size);var t,r,n;if(F.current)(null==(t=F.current)?void 0:t.scale.x)===o&&(null==(r=F.current)?void 0:r.scale.y)===o&&(null==(n=F.current)?void 0:n.scale.z)===o||(F.current.scale.setScalar(o),e.invalidate())}})),S.useImperativeHandle(D,(()=>z.current),[]),S.createElement(Ne.Provider,{value:B},S.createElement("group",{ref:L},S.createElement("group",{ref:z,matrix:e,matrixAutoUpdate:!1},S.createElement("group",{visible:C,ref:F,position:d,rotation:m},!s&&u[0]&&S.createElement(Xe,{axis:0,direction:Pt}),!s&&u[1]&&S.createElement(Xe,{axis:1,direction:Rt}),!s&&u[2]&&S.createElement(Xe,{axis:2,direction:Dt}),!c&&u[0]&&u[1]&&S.createElement(Qe,{axis:2,dir1:Pt,dir2:Rt}),!c&&u[0]&&u[2]&&S.createElement(Qe,{axis:1,dir1:Dt,dir2:Pt}),!c&&u[2]&&u[1]&&S.createElement(Qe,{axis:0,dir1:Rt,dir2:Dt}),!l&&u[0]&&u[1]&&S.createElement(st,{axis:2,dir1:Pt,dir2:Rt}),!l&&u[0]&&u[2]&&S.createElement(st,{axis:1,dir1:Dt,dir2:Pt}),!l&&u[2]&&u[1]&&S.createElement(st,{axis:0,dir1:Rt,dir2:Dt})),S.createElement("group",{ref:A},R))))}));function Lt(e,t){const r=o.useThree((e=>e.pointer)),[a]=S.useState((()=>{const a=new n.Raycaster;return t&&o.applyProps(a,t,{}),function(t,o){a.setFromCamera(r,e instanceof n.Camera?e:e.current);const i=this.constructor.prototype.raycast.bind(this);i&&i(a,o)}}));return a}const zt=S.createContext({}),Ft=()=>S.useContext(zt),At=2*Math.PI,kt=new n.Object3D,Bt=new n.Matrix4,[Ut,Vt]=[new n.Quaternion,new n.Quaternion],It=new n.Vector3,Ot=new n.Vector3,jt="#f0f0f0",Wt="#999",Nt="black",Gt="black",Ht=["Right","Left","Top","Bottom","Front","Back"],$t=e=>new n.Vector3(...e).multiplyScalar(.38),qt=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map($t),Xt=[.25,.25,.25],Zt=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map($t),Yt=Zt.map((e=>e.toArray().map((e=>0==e?.5:.25)))),Kt=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:a=Ht,color:i=jt,hoverColor:s=Wt,textColor:c=Nt,strokeColor:l=Gt,opacity:u=1})=>{const d=o.useThree((e=>e.gl)),m=S.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const o=e.getContext("2d");return o.fillStyle=i,o.fillRect(0,0,e.width,e.height),o.strokeStyle=l,o.strokeRect(0,0,e.width,e.height),o.font=r,o.textAlign="center",o.fillStyle=c,o.fillText(a[t].toUpperCase(),64,76),new n.CanvasTexture(e)}),[t,a,r,i,c,l]);return S.createElement("meshLambertMaterial",{map:m,"map-encoding":d.outputEncoding,"map-anisotropy":d.capabilities.getMaxAnisotropy()||1,attach:`material-${t}`,color:e?s:"white",transparent:!0,opacity:u})},Qt=e=>{const{tweenCamera:t,raycast:r}=Ft(),[n,o]=S.useState(null);return S.createElement("mesh",{raycast:r,onPointerOut:e=>{e.stopPropagation(),o(null)},onPointerMove:e=>{e.stopPropagation(),o(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map(((t,r)=>S.createElement(Kt,b.default({key:r,index:r,hover:n===r},e)))),S.createElement("boxGeometry",null))},Jt=({onClick:e,dimensions:t,position:r,hoverColor:n=Wt})=>{const{tweenCamera:o,raycast:a}=Ft(),[i,s]=S.useState(!1);return S.createElement("mesh",{scale:1.01,position:r,raycast:a,onPointerOver:e=>{e.stopPropagation(),s(!0)},onPointerOut:e=>{e.stopPropagation(),s(!1)},onClick:e||(e=>{e.stopPropagation(),o(r)})},S.createElement("meshBasicMaterial",{color:i?n:"white",transparent:!0,opacity:.6,visible:i}),S.createElement("boxGeometry",{args:t}))};function er({scale:e=[.8,.05,.05],color:t,rotation:r}){return S.createElement("group",{rotation:r},S.createElement("mesh",{position:[.4,0,0]},S.createElement("boxGeometry",{args:e}),S.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function tr({onClick:e,font:t,disabled:r,arcStyle:a,label:i,labelColor:s,axisHeadScale:c=1,...l}){const u=o.useThree((e=>e.gl)),d=S.useMemo((()=>{const e=document.createElement("canvas");e.width=64,e.height=64;const r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=a,r.fill(),i&&(r.font=t,r.textAlign="center",r.fillStyle=s,r.fillText(i,32,41)),new n.CanvasTexture(e)}),[a,i,s,t]),[m,f]=S.useState(!1),p=(i?1:.75)*(m?1.2:1)*c;return S.createElement("sprite",b.default({scale:p,onPointerOver:r?void 0:e=>{e.stopPropagation(),f(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),f(!1)})},l),S.createElement("spriteMaterial",{map:d,"map-encoding":u.outputEncoding,"map-anisotropy":u.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:i?1:.75,toneMapped:!1}))}function rr(e,{path:t}){const[r]=o.useLoader(n.CubeTextureLoader,[e],(e=>e.setPath(t)));return r}function nr(e){return o.useLoader(l.FBXLoader,e)}rr.preload=(e,{path:t})=>o.useLoader.preload(n.CubeTextureLoader,[e],(e=>e.setPath(t))),nr.preload=e=>o.useLoader.preload(l.FBXLoader,e),nr.clear=e=>o.useLoader.clear(l.FBXLoader,e);let or=null;function ar(e,t,r){return n=>{r&&r(n),e&&(or||(or=new l.DRACOLoader),or.setDecoderPath("string"==typeof e?e:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader(or)),t&&n.setMeshoptDecoder("function"==typeof l.MeshoptDecoder?l.MeshoptDecoder():l.MeshoptDecoder)}}function ir(e,t=!0,r=!0,n){return o.useLoader(l.GLTFLoader,e,ar(t,r,n))}ir.preload=(e,t=!0,r=!0,n)=>o.useLoader.preload(l.GLTFLoader,e,ar(t,r,n)),ir.clear=e=>o.useLoader.clear(l.GLTFLoader,e);const sr="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function cr(e,r=`${sr}/basis/`){const n=o.useThree((e=>e.gl)),a=o.useLoader(l.KTX2Loader,fe(e)?Object.values(e):e,(e=>{e.detectSupport(n),e.setTranscoderPath(r)}));if(t.useEffect((()=>{(Array.isArray(a)?a:[a]).forEach(n.initTexture)}),[n,a]),fe(e)){const t=Object.keys(e),r={};return t.forEach((e=>Object.assign(r,{[e]:a[t.indexOf(e)]}))),r}return a}function lr(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function ur(e,t,r){const{gl:n,size:a,viewport:i}=o.useThree(),s="number"==typeof e?e:a.width*i.dpr,c="number"==typeof t?t:a.height*i.dpr,l=("number"==typeof e?r:e)||{},{samples:u,...d}=l,m=S.useMemo((()=>{let e;return e=new T.WebGLRenderTarget(s,c,{minFilter:T.LinearFilter,magFilter:T.LinearFilter,encoding:n.outputEncoding,type:T.HalfFloatType,...d}),e.samples=u,e}),[]);return S.useLayoutEffect((()=>{m.setSize(s,c),u&&(m.samples=u)}),[u,m,s,c]),S.useEffect((()=>()=>m.dispose()),[]),m}cr.preload=(e,t=`${sr}/basis/`)=>o.useLoader.preload(l.KTX2Loader,e,(e=>{e.setTranscoderPath(t)})),cr.clear=e=>o.useLoader.clear(l.KTX2Loader,e);const dr=new T.Box3,mr=new T.Vector3,fr=S.forwardRef((({children:e,curve:t},r)=>{const[n]=S.useState((()=>new T.Scene)),[a,i]=S.useState(),s=S.useRef();return S.useEffect((()=>{s.current=new l.Flow(n.children[0]),i(s.current.object3D)}),[e]),S.useEffect((()=>{var e;t&&(null==(e=s.current)||e.updateCurve(0,t))}),[t]),S.useImperativeHandle(r,(()=>({moveAlongCurve:e=>{var t;null==(t=s.current)||t.moveAlongCurve(e)}}))),S.createElement(S.Fragment,null,o.createPortal(e,n),a&&S.createElement("primitive",{object:a}))}));class pr extends n.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`\n      uniform float time;\n      uniform float radius;\n      uniform float distort;\n      #define GLSLIFY 1\nvec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n        float updateTime = time / 50.0;\n        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));\n        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));\n        ")}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}const hr=S.forwardRef((({speed:e=1,...t},r)=>{const[n]=S.useState((()=>new pr));return o.useFrame((t=>n&&(n.time=t.clock.getElapsedTime()*e))),S.createElement("primitive",b.default({object:n,ref:r,attach:"material"},t))}));class vr extends n.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`\n      uniform float time;\n      uniform float factor;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","float theta = sin( time + position.y ) / 2.0 * factor;\n        float c = cos( theta );\n        float s = sin( theta );\n        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );\n        vec3 transformed = vec3( position ) * m;\n        vNormal = vNormal * m;")}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}const gr=S.forwardRef((({speed:e=1,...t},r)=>{const[n]=S.useState((()=>new vr));return o.useFrame((t=>n&&(n.time=t.clock.getElapsedTime()*e))),S.createElement("primitive",b.default({object:n,ref:r,attach:"material"},t))}));class xr extends n.ShaderMaterial{constructor(e=new n.Vector2){super({uniforms:{inputBuffer:new n.Uniform(null),depthBuffer:new n.Uniform(null),resolution:new n.Uniform(new n.Vector2),texelSize:new n.Uniform(new n.Vector2),halfTexelSize:new n.Uniform(new n.Vector2),kernel:new n.Uniform(0),scale:new n.Uniform(1),cameraNear:new n.Uniform(0),cameraFar:new n.Uniform(1),minDepthThreshold:new n.Uniform(0),maxDepthThreshold:new n.Uniform(1),depthScale:new n.Uniform(0),depthToBlurRatioBias:new n.Uniform(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:n.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class yr{constructor({gl:e,resolution:t,width:r=500,height:o=500,minDepthThreshold:a=0,maxDepthThreshold:i=1,depthScale:s=0,depthToBlurRatioBias:c=.25}){this.renderToScreen=!1,this.renderTargetA=new n.WebGLRenderTarget(t,t,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,stencilBuffer:!1,depthBuffer:!1,encoding:e.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new xr,this.convolutionMaterial.setTexelSize(1/r,1/o),this.convolutionMaterial.setResolution(new n.Vector2(r,o)),this.scene=new n.Scene,this.camera=new n.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=a,this.convolutionMaterial.uniforms.maxDepthThreshold.value=i,this.convolutionMaterial.uniforms.depthScale.value=s,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=c,this.convolutionMaterial.defines.USE_DEPTH=s>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),u=new Float32Array([0,0,2,0,0,2]),d=new n.BufferGeometry;d.setAttribute("position",new n.BufferAttribute(l,3)),d.setAttribute("uv",new n.BufferAttribute(u,2)),this.screen=new n.Mesh(d,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){const n=this.scene,o=this.camera,a=this.renderTargetA,i=this.renderTargetB;let s=this.convolutionMaterial,c=s.uniforms;c.depthBuffer.value=t.depthTexture;const l=s.kernel;let u,d,m,f=t;for(d=0,m=l.length-1;d<m;++d)u=0==(1&d)?a:i,c.kernel.value=l[d],c.inputBuffer.value=f.texture,e.setRenderTarget(u),e.render(n,o),f=u;c.kernel.value=l[d],c.inputBuffer.value=f.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(n,o)}}class wr extends n.MeshStandardMaterial{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader=`\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}o.extend({MeshReflectorMaterialImpl:wr});const Er=S.forwardRef((({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:a=[0,0],minDepthThreshold:i=.9,maxDepthThreshold:s=1,depthScale:c=0,depthToBlurRatioBias:l=.25,mirror:u=0,distortion:d=1,mixContrast:m=1,distortionMap:f,reflectorOffset:p=0,...h},v)=>{const g=o.useThree((({gl:e})=>e)),x=o.useThree((({camera:e})=>e)),y=o.useThree((({scene:e})=>e)),w=(a=Array.isArray(a)?a:[a,a])[0]+a[1]>0,E=S.useRef(null),[M]=S.useState((()=>new n.Plane)),[C]=S.useState((()=>new n.Vector3)),[T]=S.useState((()=>new n.Vector3)),[P]=S.useState((()=>new n.Vector3)),[D]=S.useState((()=>new n.Matrix4)),[_]=S.useState((()=>new n.Vector3(0,0,-1))),[L]=S.useState((()=>new n.Vector4)),[z]=S.useState((()=>new n.Vector3)),[F]=S.useState((()=>new n.Vector3)),[A]=S.useState((()=>new n.Vector4)),[k]=S.useState((()=>new n.Matrix4)),[B]=S.useState((()=>new n.PerspectiveCamera)),U=S.useCallback((()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;if(T.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(x.matrixWorld),D.extractRotation(t.matrixWorld),C.set(0,0,1),C.applyMatrix4(D),T.addScaledVector(C,p),z.subVectors(T,P),z.dot(C)>0)return;z.reflect(C).negate(),z.add(T),D.extractRotation(x.matrixWorld),_.set(0,0,-1),_.applyMatrix4(D),_.add(P),F.subVectors(T,_),F.reflect(C).negate(),F.add(T),B.position.copy(z),B.up.set(0,1,0),B.up.applyMatrix4(D),B.up.reflect(C),B.lookAt(F),B.far=x.far,B.updateMatrixWorld(),B.projectionMatrix.copy(x.projectionMatrix),k.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),k.multiply(B.projectionMatrix),k.multiply(B.matrixWorldInverse),k.multiply(t.matrixWorld),M.setFromNormalAndCoplanarPoint(C,T),M.applyMatrix4(B.matrixWorldInverse),L.set(M.normal.x,M.normal.y,M.normal.z,M.constant);const r=B.projectionMatrix;A.x=(Math.sign(L.x)+r.elements[8])/r.elements[0],A.y=(Math.sign(L.y)+r.elements[9])/r.elements[5],A.z=-1,A.w=(1+r.elements[10])/r.elements[14],L.multiplyScalar(2/L.dot(A)),r.elements[2]=L.x,r.elements[6]=L.y,r.elements[10]=L.z+1,r.elements[14]=L.w}),[x,p]),[V,I,O,j]=S.useMemo((()=>{const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,encoding:g.outputEncoding,type:n.HalfFloatType},p=new n.WebGLRenderTarget(r,r,o);p.depthBuffer=!0,p.depthTexture=new n.DepthTexture(r,r),p.depthTexture.format=n.DepthFormat,p.depthTexture.type=n.UnsignedShortType;const h=new n.WebGLRenderTarget(r,r,o);return[p,h,new yr({gl:g,resolution:r,width:a[0],height:a[1],minDepthThreshold:i,maxDepthThreshold:s,depthScale:c,depthToBlurRatioBias:l}),{mirror:u,textureMatrix:k,mixBlur:e,tDiffuse:p.texture,tDepth:p.depthTexture,tDiffuseBlur:h.texture,hasBlur:w,mixStrength:t,minDepthThreshold:i,maxDepthThreshold:s,depthScale:c,depthToBlurRatioBias:l,distortion:d,distortionMap:f,mixContrast:m,"defines-USE_BLUR":w?"":void 0,"defines-USE_DEPTH":c>0?"":void 0,"defines-USE_DISTORTION":f?"":void 0}]}),[g,a,k,r,u,w,e,t,i,s,c,l,d,f,m]);return o.useFrame((()=>{var e;const t=E.current.parent||(null==(e=E.current)?void 0:e.__r3f.parent);if(!t)return;t.visible=!1;const r=g.xr.enabled,n=g.shadowMap.autoUpdate;U(),g.xr.enabled=!1,g.shadowMap.autoUpdate=!1,g.setRenderTarget(V),g.state.buffers.depth.setMask(!0),g.autoClear||g.clear(),g.render(y,B),w&&O.render(g,V,I),g.xr.enabled=r,g.shadowMap.autoUpdate=n,t.visible=!0,g.setRenderTarget(null)})),S.createElement("meshReflectorMaterialImpl",b.default({attach:"material",key:"key"+j["defines-USE_BLUR"]+j["defines-USE_DEPTH"]+j["defines-USE_DISTORTION"],ref:R.default([E,v])},j,h))})),Mr=me({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new y.MeshBVHUniformStruct,color:new T.Color("white"),resolution:new T.Vector2},"\n  #ifndef USE_COLOR\n    uniform vec3 color;\n  #endif\n  varying vec3 vWorldPosition;  \n  varying vec3 vNormal;\n  varying mat4 projectionMatrixInv;\n  varying mat4 viewMatrixInv;\n  varying vec3 viewDirection;\n  varying mat4 vInstanceMatrix;\n  varying vec3 vColor;\n  \n  void main() {        \n    vec4 transformedNormal = vec4(normal, 0.0);\n    vec4 transformedPosition = vec4(position, 1.0);\n    #ifdef USE_INSTANCING\n      vInstanceMatrix = instanceMatrix;\n      transformedNormal = instanceMatrix * transformedNormal;\n      transformedPosition = instanceMatrix * transformedPosition;\n    #else\n      vInstanceMatrix = mat4(1.0);\n    #endif\n\n    vColor = color;\n    #ifdef USE_INSTANCING_COLOR\n      vColor *= instanceColor.rgb;\n    #endif\n  \n    projectionMatrixInv = inverse(projectionMatrix);\n    viewMatrixInv = inverse(viewMatrix);\n  \n    vWorldPosition = (modelMatrix * transformedPosition).xyz;    \n    vNormal = (viewMatrixInv * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz;\n    viewDirection = normalize(vWorldPosition - cameraPosition);\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;\n  }",`\n  #define ENVMAP_TYPE_CUBE_UV\n  precision highp isampler2D;\n  precision highp usampler2D;\n  varying vec3 vWorldPosition;\n  varying vec3 vNormal;\n    \n  #ifdef ENVMAP_TYPE_CUBEM\n    uniform samplerCube envMap;\n  #else\n    uniform sampler2D envMap;\n  #endif\n    \n  uniform float bounces;\n  ${y.shaderStructs}\n  ${y.shaderIntersectFunction}\n  uniform BVH bvh;\n  uniform float ior;\n  uniform bool correctMips;\n  uniform vec2 resolution;\n  uniform float fresnel;\n  uniform mat4 modelMatrix;\n    \n  uniform float aberrationStrength;\n  varying mat4 projectionMatrixInv;\n  varying mat4 viewMatrixInv;\n  varying vec3 viewDirection;  \n  varying mat4 vInstanceMatrix;\n  varying vec3 vColor;\n  \n  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {\n    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );\n  }\n    \n  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {\n    vec3 rayOrigin = ro;\n    vec3 rayDirection = rd;\n    rayDirection = refract(rayDirection, normal, 1.0 / ior);\n    rayOrigin = vWorldPosition + rayDirection * 0.001;\n    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;\n    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);\n    for(float i = 0.0; i < bounces; i++) {\n      uvec4 faceIndices = uvec4( 0u );\n      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );\n      vec3 barycoord = vec3( 0.0 );\n      float side = 1.0;\n      float dist = 0.0;\n      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );\n      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);      \n      vec3 tempDir = refract(rayDirection, faceNormal, ior);\n      if (length(tempDir) != 0.0) {\n        rayDirection = tempDir;\n        break;\n      }\n      rayDirection = reflect(rayDirection, faceNormal);\n      rayOrigin = hitPos + rayDirection * 0.01;\n    }\n    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);\n    return rayDirection;\n  }\n    \n  #include <common>\n  #include <cube_uv_reflection_fragment>\n    \n  #ifdef ENVMAP_TYPE_CUBEM\n    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));\n    }\n  #else\n    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {\n      vec2 uvv = equirectUv( rayDirection );\n      vec2 smoothUv = equirectUv( directionCamPerfect );\n      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));\n    }\n  #endif\n  \n  void main() {\n    mat4 modelMatrixInverse = inverse(modelMatrix * vInstanceMatrix);\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec3 directionCamPerfect = (projectionMatrixInv * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;\n    directionCamPerfect = (viewMatrixInv * vec4(directionCamPerfect, 0.0)).xyz;\n    directionCamPerfect = normalize(directionCamPerfect);\n    vec3 normal = vNormal;\n    vec3 rayOrigin = cameraPosition;\n    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);\n    vec3 finalColor;\n    #ifdef CHROMATIC_ABERRATIONS\n      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), modelMatrixInverse);\n      #ifdef FAST_CHROMA \n        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));\n        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));\n      #else\n        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), modelMatrixInverse);\n        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), modelMatrixInverse);\n      #endif\n      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;\n      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;\n      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;\n      finalColor = vec3(finalColorR, finalColorG, finalColorB) * vColor;\n    #else\n      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), modelMatrixInverse);\n      finalColor = textureGradient(envMap, rayDirection, directionCamPerfect).rgb;    \n      finalColor *= vColor;\n    #endif\n    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;\n    gl_FragColor = vec4(mix(finalColor, vec3(1.0), nFresnel), 1.0);      \n    #include <tonemapping_fragment>\n    #include <encodings_fragment>\n  }`);class br extends T.PointsMaterial{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{const{isWebGL2:r}=t.capabilities;e.fragmentShader=e.fragmentShader.replace("#include <output_fragment>",`\n        ${r?"#include <output_fragment>":"#extension GL_OES_standard_derivatives : enable\n#include <output_fragment>"}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      `)}}}const Sr=S.forwardRef(((e,t)=>{const[r]=S.useState((()=>new br(null)));return S.createElement("primitive",b.default({},e,{object:r,ref:t,attach:"material"}))}));let Cr=!1;function Tr(e){const t=e+"Geometry";return S.forwardRef((({args:e,children:r,...n},o)=>S.createElement("mesh",b.default({ref:o},n),S.createElement(t,{attach:"geometry",args:e}),r)))}const Pr=Tr("box"),Rr=Tr("circle"),Dr=Tr("cone"),_r=Tr("cylinder"),Lr=Tr("sphere"),zr=Tr("plane"),Fr=Tr("tube"),Ar=Tr("torus"),kr=Tr("torusKnot"),Br=Tr("tetrahedron"),Ur=Tr("ring"),Vr=Tr("polyhedron"),Ir=Tr("icosahedron"),Or=Tr("octahedron"),jr=Tr("dodecahedron"),Wr=Tr("extrude"),Nr=Tr("lathe"),Gr=Tr("capsule"),Hr=1e-5;const $r=S.forwardRef((function({args:[e=1,t=1,r=1]=[],radius:o=.05,steps:a=1,smoothness:i=4,children:s,...c},l){const u=S.useMemo((()=>function(e,t,r){const o=new n.Shape,a=r-Hr;return o.absarc(Hr,Hr,Hr,-Math.PI/2,-Math.PI,!0),o.absarc(Hr,t-2*a,Hr,Math.PI,Math.PI/2,!0),o.absarc(e-2*a,t-2*a,Hr,Math.PI/2,0,!0),o.absarc(e-2*a,Hr,Hr,0,-Math.PI/2,!0),o}(e,t,o)),[e,t,o]),d=S.useMemo((()=>({depth:r-2*o,bevelEnabled:!0,bevelSegments:2*i,steps:a,bevelSize:o-Hr,bevelThickness:o,curveSegments:i})),[r,o,i]),m=S.useRef();return S.useLayoutEffect((()=>{m.current&&m.current.center()}),[u,d]),S.createElement("mesh",b.default({ref:l},c),S.createElement("extrudeGeometry",{ref:m,args:[u,d]}),s)}));function qr(){const e=new T.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.setAttribute("position",new T.BufferAttribute(t,2)),e}const Xr=S.forwardRef((function({children:e,...t},r){const n=S.useMemo(qr,[]);return S.createElement("mesh",b.default({ref:r,geometry:n,frustumCulled:!1},t),e)})),Zr=S.forwardRef((function({children:e,left:t,right:r,top:o,bottom:a,front:i,back:s,onCentered:c,precise:l=!0,...u},d){const m=S.useRef(null),f=S.useRef(null),p=S.useRef(null);return S.useLayoutEffect((()=>{f.current.matrixWorld.identity();const e=(new n.Box3).setFromObject(p.current,l),u=new n.Vector3,d=new n.Sphere,h=e.max.x-e.min.x,v=e.max.y-e.min.y,g=e.max.z-e.min.z;e.getCenter(u),e.getBoundingSphere(d);const x=o?v/2:a?-v/2:0,y=t?-h/2:r?h/2:0,w=i?g/2:s?-g/2:0;f.current.position.set(-u.x+y,-u.y+x,-u.z+w),void 0!==c&&c({parent:m.current.parent,container:m.current,width:h,height:v,depth:g,boundingBox:e,boundingSphere:d,center:u,verticalAlignment:x,horizontalAlignment:y,depthAlignment:w})}),[e]),S.useImperativeHandle(d,(()=>m.current),[]),S.createElement("group",b.default({ref:m},u),S.createElement("group",{ref:f},S.createElement("group",{ref:p},e)))})),Yr=e=>e&&e.isOrthographicCamera,Kr=S.createContext(null);const Qr=S.forwardRef((({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:n=.1,maxPitch:a=.1,maxRoll:i=.1,yawFrequency:s=.1,pitchFrequency:c=.1,rollFrequency:u=.1},d)=>{const m=o.useThree((e=>e.camera)),f=o.useThree((e=>e.controls)),p=S.useRef(e),h=S.useRef(m.rotation.clone()),[v]=S.useState((()=>new l.SimplexNoise)),[g]=S.useState((()=>new l.SimplexNoise)),[x]=S.useState((()=>new l.SimplexNoise)),y=()=>{(p.current<0||p.current>1)&&(p.current=p.current<0?0:1)};return S.useImperativeHandle(d,(()=>({getIntensity:()=>p.current,setIntensity:e=>{p.current=e,y()}})),[]),S.useEffect((()=>{if(f){const e=()=>{h.current=m.rotation.clone()};return f.addEventListener("change",e),e(),()=>{f.removeEventListener("change",e)}}}),[m,f]),o.useFrame(((e,o)=>{const l=Math.pow(p.current,2),d=n*l*v.noise(e.clock.elapsedTime*s,1),f=a*l*g.noise(e.clock.elapsedTime*c,1),w=i*l*x.noise(e.clock.elapsedTime*u,1);m.rotation.set(h.current.x+f,h.current.y+d,h.current.z+w),t&&p.current>0&&(p.current-=r*o,y())})),null})),Jr=S.forwardRef((({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:n=1,floatingRange:a=[-.1,.1],...i},s)=>{const c=S.useRef(null),l=S.useRef(1e4*Math.random());return o.useFrame((e=>{var o,i;const s=l.current+e.clock.getElapsedTime();c.current.rotation.x=Math.cos(s/4*t)/8*r,c.current.rotation.y=Math.sin(s/4*t)/8*r,c.current.rotation.z=Math.sin(s/4*t)/20*r;let u=Math.sin(s/4*t)/10;u=T.MathUtils.mapLinear(u,-.1,.1,null!==(o=null==a?void 0:a[0])&&void 0!==o?o:-.1,null!==(i=null==a?void 0:a[1])&&void 0!==i?i:.1),c.current.position.y=u*n})),S.createElement("group",i,S.createElement("group",{ref:R.default([c,s])},e))})),en={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},tn=e=>{return(t=e).current&&t.current.isScene?e.current:e;var t};function rn({scene:e,background:t=!1,map:r}){const n=o.useThree((e=>e.scene));return S.useLayoutEffect((()=>{if(r){const o=tn(e||n),a=o.background,i=o.environment;return"only"!==t&&(o.environment=r),t&&(o.background=r),()=>{"only"!==t&&(o.environment=i),t&&(o.background=a)}}}),[n,e,r,t]),null}function nn({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:r,encoding:a,extensions:i}){if(r){if(!(r in en))throw new Error("Preset must be one of: "+Object.keys(en).join(", "));e=en[r],t="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const s=Array.isArray(e),c=s?n.CubeTextureLoader:l.RGBELoader,u=o.useLoader(c,s?[e]:e,(e=>{e.setPath(t),i&&i(e)})),d=s?u[0]:u;return d.mapping=s?n.CubeReflectionMapping:n.EquirectangularReflectionMapping,d.encoding=(null!=a?a:s)?n.sRGBEncoding:n.LinearEncoding,d}function on({background:e=!1,scene:t,...r}){const n=nn(r),a=o.useThree((e=>e.scene));return S.useLayoutEffect((()=>{const r=tn(t||a),o=r.background,i=r.environment;return"only"!==e&&(r.environment=n),e&&(r.background=n),()=>{"only"!==e&&(r.environment=i),e&&(r.background=o)}}),[n,e,t,a]),null}function an({children:e,near:t=1,far:r=1e3,resolution:a=256,frames:i=1,map:s,background:c=!1,scene:l,files:u,path:d,preset:m,extensions:f}){const p=o.useThree((e=>e.gl)),h=o.useThree((e=>e.scene)),v=S.useRef(null),[g]=S.useState((()=>new n.Scene)),x=S.useMemo((()=>{const e=new n.WebGLCubeRenderTarget(a);return e.texture.type=n.HalfFloatType,e}),[a]);S.useLayoutEffect((()=>{1===i&&v.current.update(p,g);const e=tn(l||h),t=e.background,r=e.environment;return"only"!==c&&(e.environment=x.texture),c&&(e.background=x.texture),()=>{"only"!==c&&(e.environment=r),c&&(e.background=t)}}),[e,g,x.texture,l,h,c,i,p]);let y=1;return o.useFrame((()=>{(i===1/0||y<i)&&(v.current.update(p,g),y++)})),S.createElement(S.Fragment,null,o.createPortal(S.createElement(S.Fragment,null,e,S.createElement("cubeCamera",{ref:v,args:[t,r,x]}),u||m?S.createElement(on,{background:!0,files:u,preset:m,path:d,extensions:f}):s?S.createElement(rn,{background:!0,map:s,extensions:f}):null),g))}function sn(e){var t,r,n,a;const i=nn(e),s=e.map||i;S.useMemo((()=>{o.extend({GroundProjectedEnvImpl:l.GroundProjectedEnv})}),[]);const c=S.useMemo((()=>[s]),[s]),u=null==(t=e.ground)?void 0:t.height,d=null==(r=e.ground)?void 0:r.radius,m=null!==(n=null==(a=e.ground)?void 0:a.scale)&&void 0!==n?n:1e3;return S.createElement(S.Fragment,null,S.createElement(rn,b.default({},e,{map:s})),S.createElement("groundProjectedEnvImpl",{args:c,scale:m,height:u,radius:d}))}function cn(e){return e.ground?S.createElement(sn,e):e.map?S.createElement(rn,e):e.children?S.createElement(an,e):S.createElement(on,e)}const ln=S.forwardRef((({scale:e=10,frames:t=1/0,opacity:r=1,width:n=1,height:a=1,blur:i=1,far:s=10,resolution:c=512,smooth:u=!0,color:d="#000000",depthWrite:m=!1,renderOrder:f,...p},h)=>{const v=o.useThree((e=>e.scene)),g=o.useThree((e=>e.gl)),x=S.useRef(null);n*=Array.isArray(e)?e[0]:e||1,a*=Array.isArray(e)?e[1]:e||1;const[y,w,E,M,C,P,R]=S.useMemo((()=>{const e=new T.WebGLRenderTarget(c,c),t=new T.WebGLRenderTarget(c,c);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;const r=new T.PlaneGeometry(n,a).rotateX(Math.PI/2),o=new T.Mesh(r),i=new T.MeshDepthMaterial;i.depthTest=i.depthWrite=!1,i.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new T.Color(d)}},e.fragmentShader=e.fragmentShader.replace("void main() {","uniform vec3 ucolor;\n           void main() {\n          "),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const s=new T.ShaderMaterial(l.HorizontalBlurShader),u=new T.ShaderMaterial(l.VerticalBlurShader);return u.depthTest=s.depthTest=!1,[e,r,i,o,s,u,t]}),[c,n,a,e,d]),D=e=>{M.visible=!0,M.material=C,C.uniforms.tDiffuse.value=y.texture,C.uniforms.h.value=1*e/256,g.setRenderTarget(R),g.render(M,x.current),M.material=P,P.uniforms.tDiffuse.value=R.texture,P.uniforms.v.value=1*e/256,g.setRenderTarget(y),g.render(M,x.current),M.visible=!1};let _=0;return o.useFrame((()=>{if(x.current&&(t===1/0||_<t)){const e=v.background;v.background=null;const t=v.overrideMaterial;v.overrideMaterial=E,g.setRenderTarget(y),g.render(v,x.current),v.overrideMaterial=t,D(i),u&&D(.4*i),g.setRenderTarget(null),v.background=e,_++}})),S.createElement("group",b.default({"rotation-x":Math.PI/2},p,{ref:h}),S.createElement("mesh",{renderOrder:f,geometry:w,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},S.createElement("meshBasicMaterial",{map:y.texture,"map-encoding":g.outputEncoding,transparent:!0,opacity:r,depthWrite:m})),S.createElement("orthographicCamera",{ref:x,args:[-n/2,n/2,a/2,-a/2,0,s]}))})),un={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};const dn=e=>0===e?0:Math.pow(2,10*e-10);const mn=S.forwardRef((({fog:e=!1,renderOrder:t,depthWrite:r=!1,colorStop:o=0,color:a="black",opacity:i=.5,...s},c)=>{const l=S.useMemo((()=>{const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),r=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return r.addColorStop(o,new n.Color(a).getStyle()),r.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=r,t.fillRect(0,0,e.width,e.height),e}),[a,o]);return S.createElement("mesh",b.default({renderOrder:t,ref:c,"rotation-x":-Math.PI/2},s),S.createElement("planeGeometry",null),S.createElement("meshBasicMaterial",{transparent:!0,opacity:i,fog:e,depthWrite:r,side:n.DoubleSide},S.createElement("canvasTexture",{attach:"map",args:[l]})))}));const fn=S.createContext(null),pn=me({color:new T.Color,blend:2,alphaTest:.75,opacity:0,map:null},"varying vec2 vUv;\n   void main() {\n     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);\n     vUv = uv;\n   }","varying vec2 vUv;\n   uniform sampler2D map;\n   uniform vec3 color;\n   uniform float opacity;\n   uniform float alphaTest;\n   uniform float blend;\n   void main() {\n     vec4 sampledDiffuseColor = texture2D(map, vUv);\n     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);\n     #include <tonemapping_fragment>\n     #include <encodings_fragment>\n   }"),hn=me({},"void main() { gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }","void main() { discard; }"),vn=S.forwardRef((({children:e,temporal:t,frames:r=40,limit:n=1/0,blend:a=20,scale:i=10,opacity:s=1,alphaTest:c=.75,color:l="black",colorBlend:u=2,resolution:d=1024,toneMapped:m=!0,...f},p)=>{o.extend({SoftShadowMaterial:pn});const h=o.useThree((e=>e.gl)),v=o.useThree((e=>e.scene)),g=o.useThree((e=>e.camera)),x=S.useRef(null),y=S.useRef(null),[w]=S.useState((()=>new xn(h,v,d)));S.useLayoutEffect((()=>{w.configure(x.current)}),[]);const E=S.useMemo((()=>({lights:new Map,temporal:!!t,frames:Math.max(2,r),blend:Math.max(2,r===1/0?a:r),count:0,getMesh:()=>x.current,reset:()=>{w.clear();const e=x.current.material;e.opacity=0,e.alphaTest=0,E.count=0},update:(e=1)=>{const t=x.current.material;E.temporal?(t.opacity=Math.min(s,t.opacity+s/E.blend),t.alphaTest=Math.min(c,t.alphaTest+c/E.blend)):(t.opacity=s,t.alphaTest=c),y.current.visible=!0,w.prepare();for(let t=0;t<e;t++)E.lights.forEach((e=>e.update())),w.update(g,E.blend);y.current.visible=!1,w.finish()}})),[w,g,v,t,r,a,s,c]);return S.useLayoutEffect((()=>{E.reset(),E.temporal||E.frames===1/0||E.update(E.blend)})),S.useImperativeHandle(p,(()=>E),[E]),o.useFrame((()=>{(E.temporal||E.frames===1/0)&&E.count<E.frames&&E.count<n&&(E.update(),E.count++)})),S.createElement("group",f,S.createElement("group",{traverse:()=>null,ref:y},S.createElement(fn.Provider,{value:E},e)),S.createElement("mesh",{receiveShadow:!0,ref:x,scale:i,rotation:[-Math.PI/2,0,0]},S.createElement("planeGeometry",null),S.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:m,color:l,blend:u,map:w.progressiveLightMap2.texture})))})),gn=S.forwardRef((({castShadow:e=!0,bias:t=.001,mapSize:r=512,size:n=5,near:o=.5,far:a=500,frames:i=1,position:s=[0,0,0],radius:c=1,amount:l=8,intensity:u=1,ambient:d=.5,...m},f)=>{const p=S.useRef(null),h=new T.Vector3(...s).length(),v=S.useContext(fn),g=S.useCallback((()=>{let e;if(p.current)for(let t=0;t<p.current.children.length;t++)if(e=p.current.children[t],Math.random()>d)e.position.set(s[0]+T.MathUtils.randFloatSpread(c),s[1]+T.MathUtils.randFloatSpread(c),s[2]+T.MathUtils.randFloatSpread(c));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,r=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(r)*h,Math.abs(Math.cos(t)*Math.sin(r)*h),Math.sin(t)*h)}}),[c,d,h,...s]),x=S.useMemo((()=>({update:g})),[g]);return S.useImperativeHandle(f,(()=>x),[x]),S.useLayoutEffect((()=>{const e=p.current;return v&&v.lights.set(e.uuid,x),()=>{v.lights.delete(e.uuid)}}),[v,x]),S.createElement("group",b.default({ref:p},m),Array.from({length:l},((i,s)=>S.createElement("directionalLight",{key:s,castShadow:e,"shadow-bias":t,"shadow-mapSize":[r,r],intensity:u/l},S.createElement("orthographicCamera",{attach:"shadow-camera",args:[-n,n,n,-n,o,a]})))))}));class xn{constructor(e,t,r=1024){this.renderer=e,this.res=r,this.scene=t,this.scene.background=null,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null;const n=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?T.HalfFloatType:T.FloatType;this.progressiveLightMap1=new T.WebGLRenderTarget(this.res,this.res,{type:n,encoding:e.outputEncoding}),this.progressiveLightMap2=new T.WebGLRenderTarget(this.res,this.res,{type:n,encoding:e.outputEncoding}),this.discardMat=new hn,this.targetMat=new T.MeshPhongMaterial({shininess:0}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const t=e.fragmentShader.indexOf("void main() {");e.fragmentShader=e.fragmentShader.replace("#include <clipping_planes_pars_fragment>","#include <clipping_planes_pars_fragment>\n#include <shadowmask_pars_fragment>\n"),e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"\tuniform sampler2D previousShadowMap;\n\tuniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+"\nvec3 texelOld = texture2D(previousShadowMap, vUv).rgb;\n        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);\n      }",e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.lights=[],this.meshes=[],this.scene.traverse((e=>{!function(e){return!!e.geometry}(e)?function(e){return e.isLight}(e)&&this.lights.push({object:e,intensity:e.intensity}):this.meshes.push({object:e,material:e.material})}))}prepare(){this.lights.forEach((e=>e.object.intensity=0)),this.meshes.forEach((e=>e.object.material=this.discardMat))}finish(){this.lights.forEach((e=>e.object.intensity=e.intensity)),this.meshes.forEach((e=>e.object.material=e.material))}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;const r=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,n=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(r),this.previousShadowMap.value=n.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null)}}o.extend({MeshReflectorMaterial:wr});const yn=S.forwardRef((({mixBlur:e=0,mixStrength:t=.5,resolution:r=256,blur:a=[0,0],args:i=[1,1],minDepthThreshold:s=.9,maxDepthThreshold:c=1,depthScale:l=0,depthToBlurRatioBias:u=.25,mirror:d=0,children:m,debug:f=0,distortion:p=1,mixContrast:h=1,distortionMap:v,...g},x)=>{S.useEffect((()=>{console.warn("Reflector has been deprecated and will be removed next major. Replace it with <MeshReflectorMaterial />!")}),[]);const y=o.useThree((({gl:e})=>e)),w=o.useThree((({camera:e})=>e)),E=o.useThree((({scene:e})=>e)),M=(a=Array.isArray(a)?a:[a,a])[0]+a[1]>0,C=S.useRef(null),[T]=S.useState((()=>new n.Plane)),[P]=S.useState((()=>new n.Vector3)),[D]=S.useState((()=>new n.Vector3)),[_]=S.useState((()=>new n.Vector3)),[L]=S.useState((()=>new n.Matrix4)),[z]=S.useState((()=>new n.Vector3(0,0,-1))),[F]=S.useState((()=>new n.Vector4)),[A]=S.useState((()=>new n.Vector3)),[k]=S.useState((()=>new n.Vector3)),[B]=S.useState((()=>new n.Vector4)),[U]=S.useState((()=>new n.Matrix4)),[V]=S.useState((()=>new n.PerspectiveCamera)),I=S.useCallback((()=>{if(D.setFromMatrixPosition(C.current.matrixWorld),_.setFromMatrixPosition(w.matrixWorld),L.extractRotation(C.current.matrixWorld),P.set(0,0,1),P.applyMatrix4(L),A.subVectors(D,_),A.dot(P)>0)return;A.reflect(P).negate(),A.add(D),L.extractRotation(w.matrixWorld),z.set(0,0,-1),z.applyMatrix4(L),z.add(_),k.subVectors(D,z),k.reflect(P).negate(),k.add(D),V.position.copy(A),V.up.set(0,1,0),V.up.applyMatrix4(L),V.up.reflect(P),V.lookAt(k),V.far=w.far,V.updateMatrixWorld(),V.projectionMatrix.copy(w.projectionMatrix),U.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),U.multiply(V.projectionMatrix),U.multiply(V.matrixWorldInverse),U.multiply(C.current.matrixWorld),T.setFromNormalAndCoplanarPoint(P,D),T.applyMatrix4(V.matrixWorldInverse),F.set(T.normal.x,T.normal.y,T.normal.z,T.constant);const e=V.projectionMatrix;B.x=(Math.sign(F.x)+e.elements[8])/e.elements[0],B.y=(Math.sign(F.y)+e.elements[9])/e.elements[5],B.z=-1,B.w=(1+e.elements[10])/e.elements[14],F.multiplyScalar(2/F.dot(B)),e.elements[2]=F.x,e.elements[6]=F.y,e.elements[10]=F.z+1,e.elements[14]=F.w}),[]),[O,j,W,N]=S.useMemo((()=>{const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,encoding:y.outputEncoding},i=new n.WebGLRenderTarget(r,r,o);i.depthBuffer=!0,i.depthTexture=new n.DepthTexture(r,r),i.depthTexture.format=n.DepthFormat,i.depthTexture.type=n.UnsignedShortType;const m=new n.WebGLRenderTarget(r,r,o);return[i,m,new yr({gl:y,resolution:r,width:a[0],height:a[1],minDepthThreshold:s,maxDepthThreshold:c,depthScale:l,depthToBlurRatioBias:u}),{mirror:d,textureMatrix:U,mixBlur:e,tDiffuse:i.texture,tDepth:i.depthTexture,tDiffuseBlur:m.texture,hasBlur:M,mixStrength:t,minDepthThreshold:s,maxDepthThreshold:c,depthScale:l,depthToBlurRatioBias:u,transparent:!0,debug:f,distortion:p,distortionMap:v,mixContrast:h,"defines-USE_BLUR":M?"":void 0,"defines-USE_DEPTH":l>0?"":void 0,"defines-USE_DISTORTION":v?"":void 0}]}),[y,a,U,r,d,M,e,t,s,c,l,u,f,p,v,h]);return o.useFrame((()=>{if(null==C||!C.current)return;C.current.visible=!1;const e=y.xr.enabled,t=y.shadowMap.autoUpdate;I(),y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,y.setRenderTarget(O),y.state.buffers.depth.setMask(!0),y.autoClear||y.clear(),y.render(E,V),M&&W.render(y,O,j),y.xr.enabled=e,y.shadowMap.autoUpdate=t,C.current.visible=!0,y.setRenderTarget(null)})),S.createElement("mesh",b.default({ref:R.default([C,x])},g),S.createElement("planeGeometry",{args:i}),m?m("meshReflectorMaterial",N):S.createElement("meshReflectorMaterial",N))}));class wn extends n.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new n.Vector3(0,0,0)},lightColor:{value:new n.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new n.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform vec3 spotPosition;\n      uniform float attenuation;      \n\n      void main() {\n        // compute intensity\n        vNormal = normalize( normalMatrix * normal );\n        vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n        vec4 viewPosition = viewMatrix * worldPosition;\n        vViewZ = viewPosition.z;\n        float intensity\t= distance(worldPosition.xyz, spotPosition) / attenuation;\n        intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\n        vIntensity = intensity;        \n        // set gl_Position\n        gl_Position\t= projectionMatrix * viewPosition;\n\n      }",fragmentShader:"\n      #include <packing>\n\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      uniform vec3 lightColor;\n      uniform vec3 spotPosition;\n      uniform float attenuation;\n      uniform float anglePower;\n      uniform sampler2D depth;\n      uniform vec2 resolution;\n      uniform float cameraNear;\n      uniform float cameraFar;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform float opacity;\n\n      float readDepth( sampler2D depthSampler, vec2 coord ) {\n        float fragCoordZ = texture2D( depthSampler, coord ).x;\n        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n        return viewZ;\n      }\n\n      void main() {\n        float d = 1.0;\n        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n        if (isSoft) {\n          vec2 sUv = gl_FragCoord.xy / resolution;\n          d = readDepth(depth, sUv);\n        }\n        float intensity = vIntensity;\n        vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n        float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\n        intensity\t*= angleIntensity;\n        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n        if (isSoft) {\n          intensity\t*= smoothstep(0., 1., vViewZ - d);\n        }\n        gl_FragColor = vec4(lightColor, intensity * opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}}const En=new n.Vector3,Mn=S.forwardRef((({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:a,color:i="white",distance:s=5,angle:c=.15,attenuation:l=5,anglePower:u=5,...d},m)=>{const f=S.useRef(null),p=o.useThree((e=>e.size)),h=o.useThree((e=>e.camera)),v=o.useThree((e=>e.viewport.dpr)),[g]=S.useState((()=>new wn));t=void 0===t?.1:t,r=void 0===r?7*c:r,o.useFrame((()=>{g.uniforms.spotPosition.value.copy(f.current.getWorldPosition(En)),f.current.lookAt(f.current.parent.target.getWorldPosition(En))}));const x=S.useMemo((()=>{const e=new n.CylinderGeometry(t,r,s,128,64,!0);return e.applyMatrix4((new n.Matrix4).makeTranslation(0,-s/2,0)),e.applyMatrix4((new n.Matrix4).makeRotationX(-Math.PI/2)),e}),[c,s,t,r]);return S.createElement("spotLight",b.default({ref:m,angle:c,color:i,distance:s},d),S.createElement("mesh",{ref:f,geometry:x,raycast:()=>null},S.createElement("primitive",{object:g,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":i,"uniforms-attenuation-value":l,"uniforms-anglePower-value":u,"uniforms-depth-value":a,"uniforms-cameraNear-value":h.near,"uniforms-cameraFar-value":h.far,"uniforms-resolution-value":a?[p.width*v,p.height*v]:[0,0]})))})),bn=S.forwardRef((({args:e,map:t,toneMapped:r=!1,color:n="white",form:a="rect",intensity:i=1,scale:s=1,target:c,children:l,...u},d)=>{const m=S.useRef(null);return S.useLayoutEffect((()=>{l||u.material||(o.applyProps(m.current.material,{color:n}),m.current.material.color.multiplyScalar(i))}),[n,i,l,u.material]),S.useLayoutEffect((()=>{c&&m.current.lookAt(Array.isArray(c)?new T.Vector3(...c):c)}),[c]),s=Array.isArray(s)&&2===s.length?[s[0],s[1],1]:s,S.createElement("mesh",b.default({ref:R.default([m,d]),scale:s},u),"circle"===a?S.createElement("ringGeometry",{args:[0,1,64]}):"ring"===a?S.createElement("ringGeometry",{args:[.5,1,64]}):"rect"===a?S.createElement("planeGeometry",null):S.createElement(a,{args:e}),l||(u.material?null:S.createElement("meshBasicMaterial",{toneMapped:r,map:t,side:T.DoubleSide})))}));function Sn(e,t,r=new n.Vector3){const o=Math.PI*(e-.5),a=2*Math.PI*(t-.5);return r.x=Math.cos(a),r.y=Math.sin(o),r.z=Math.sin(a),r}const Cn=S.forwardRef((({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:o=.005,mieDirectionalG:a=.8,rayleigh:i=.5,turbidity:s=10,sunPosition:c=Sn(e,t),...u},d)=>{const m=S.useMemo((()=>(new n.Vector3).setScalar(r)),[r]),[f]=S.useState((()=>new l.Sky));return S.createElement("primitive",b.default({object:f,ref:d,"material-uniforms-mieCoefficient-value":o,"material-uniforms-mieDirectionalG-value":a,"material-uniforms-rayleigh-value":i,"material-uniforms-sunPosition-value":c,"material-uniforms-turbidity-value":s,scale:m},u))}));class Tn extends n.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}}const Pn=e=>(new n.Vector3).setFromSpherical(new n.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),Rn=S.forwardRef((({radius:e=100,depth:t=50,count:r=5e3,saturation:a=0,factor:i=4,fade:s=!1,speed:c=1},l)=>{const u=S.useRef(),[d,m,f]=S.useMemo((()=>{const o=[],s=[],c=Array.from({length:r},(()=>(.5+.5*Math.random())*i)),l=new n.Color;let u=e+t;const d=t/r;for(let e=0;e<r;e++)u-=d*Math.random(),o.push(...Pn(u).toArray()),l.setHSL(e/r,a,.9),s.push(l.r,l.g,l.b);return[new Float32Array(o),new Float32Array(s),new Float32Array(c)]}),[r,t,i,e,a]);o.useFrame((e=>u.current&&(u.current.uniforms.time.value=e.clock.getElapsedTime()*c)));const[p]=S.useState((()=>new Tn));return S.createElement("points",{ref:l},S.createElement("bufferGeometry",null,S.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),S.createElement("bufferAttribute",{attach:"attributes-color",args:[m,3]}),S.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]})),S.createElement("primitive",{ref:u,object:p,attach:"material",blending:n.AdditiveBlending,"uniforms-fade-value":s,transparent:!0,vertexColors:!0}))}));const Dn=me({time:0,pixelRatio:1},"#define GLSLIFY 1\nuniform float pixelRatio;uniform float time;attribute float size;attribute float speed;attribute float opacity;attribute vec3 noise;attribute vec3 color;varying vec3 vColor;varying float vOpacity;void main(){vec4 modelPosition=modelMatrix*vec4(position,1.0);modelPosition.y+=sin(time*speed+modelPosition.x*noise.x*100.0)*0.2;modelPosition.z+=cos(time*speed+modelPosition.x*noise.y*100.0)*0.2;modelPosition.x+=cos(time*speed+modelPosition.x*noise.z*100.0)*0.2;vec4 viewPosition=viewMatrix*modelPosition;vec4 projectionPostion=projectionMatrix*viewPosition;gl_Position=projectionPostion;gl_PointSize=size*25.*pixelRatio;gl_PointSize*=(1.0/-viewPosition.z);vColor=color;vOpacity=opacity;}","#define GLSLIFY 1\nvarying vec3 vColor;varying float vOpacity;void main(){float distanceToCenter=distance(gl_PointCoord,vec2(0.5));float strength=0.05/distanceToCenter-0.1;gl_FragColor=vec4(vColor,strength*vOpacity);}"),_n=e=>e&&e.constructor===Float32Array,Ln=e=>e instanceof T.Vector2||e instanceof T.Vector3||e instanceof T.Vector4,zn=e=>Array.isArray(e)?e:Ln(e)?e.toArray():[e,e,e];function Fn(e,t,r){return S.useMemo((()=>{if(void 0!==t){if(_n(t))return t;if(t instanceof T.Color){const r=Array.from({length:3*e},(()=>(e=>[e.r,e.g,e.b])(t))).flat();return Float32Array.from(r)}if(Ln(t)||Array.isArray(t)){const r=Array.from({length:3*e},(()=>zn(t))).flat();return Float32Array.from(r)}return Float32Array.from({length:e},(()=>t))}return Float32Array.from({length:e},r)}),[t])}const An=S.forwardRef((({noise:e=1,count:t=100,speed:r=1,opacity:n=1,scale:a=1,size:i,color:s,...c},l)=>{S.useMemo((()=>o.extend({SparklesMaterial:Dn})),[]);const u=S.useRef(),d=o.useThree((e=>e.viewport.dpr)),m=S.useMemo((()=>Float32Array.from(Array.from({length:t},(()=>zn(a).map(T.MathUtils.randFloatSpread))).flat())),[t,a]),f=Fn(t,i,Math.random),p=Fn(t,n),h=Fn(t,r),v=Fn(3*t,e),g=Fn(void 0===s?3*t:t,_n(s)?s:new T.Color(s),(()=>1));return o.useFrame((e=>u.current.uniforms.time.value=e.clock.elapsedTime)),S.createElement("points",b.default({key:`particle-${t}-${JSON.stringify(a)}`},c,{ref:l}),S.createElement("bufferGeometry",null,S.createElement("bufferAttribute",{attach:"attributes-position",args:[m,3]}),S.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]}),S.createElement("bufferAttribute",{attach:"attributes-opacity",args:[p,1]}),S.createElement("bufferAttribute",{attach:"attributes-speed",args:[h,1]}),S.createElement("bufferAttribute",{attach:"attributes-color",args:[g,3]}),S.createElement("bufferAttribute",{attach:"attributes-noise",args:[v,3]})),S.createElement("sparklesMaterial",{ref:u,transparent:!0,pixelRatio:d,depthWrite:!1}))}));const kn=new T.Matrix4,Bn=new T.Matrix4,Un=[],Vn=new T.Mesh;class In extends T.Group{constructor(){super(),this.color=new T.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){const r=this.instance.current;if(!r)return;if(!r.geometry||!r.material)return;Vn.geometry=r.geometry;const n=r.matrixWorld;let o=r.userData.instances.indexOf(this.instanceKey);if(!(-1===o||o>r.count)){r.getMatrixAt(o,kn),Bn.multiplyMatrices(n,kn),Vn.matrixWorld=Bn,Vn.raycast(e,Un);for(let e=0,r=Un.length;e<r;e++){const r=Un[e];r.instanceId=o,r.object=this,t.push(r)}Un.length=0}}}let On,jn;const Wn=S.createContext(null),Nn=new T.Matrix4,Gn=new T.Vector3;new T.Color;const Hn=S.forwardRef((({children:e,range:t,limit:r=1e3,...n},a)=>{const i=S.useRef(null),[s,c]=S.useState([]),[[l,u,d]]=S.useState((()=>[new Float32Array(3*r),Float32Array.from({length:3*r},(()=>1)),Float32Array.from({length:r},(()=>1))]));S.useEffect((()=>{i.current.geometry.attributes.position.needsUpdate=!0})),o.useFrame((()=>{for(i.current.updateMatrix(),i.current.updateMatrixWorld(),Nn.copy(i.current.matrixWorld).invert(),i.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,s.length),On=0;On<s.length;On++)jn=s[On].current,jn.getWorldPosition(Gn).applyMatrix4(Nn),Gn.toArray(l,3*On),i.current.geometry.attributes.position.needsUpdate=!0,jn.matrixWorldNeedsUpdate=!0,jn.color.toArray(u,3*On),i.current.geometry.attributes.color.needsUpdate=!0,d.set([jn.size],On),i.current.geometry.attributes.size.needsUpdate=!0}));const m=S.useMemo((()=>{const e={};for(On=0;On<s.length;On++){var t;Object.assign(e,null==(t=s[On].current)?void 0:t.__r3f.handlers)}return Object.keys(e).reduce(((e,t)=>({...e,[t]:e=>{var r,n,o;const a=null==(r=s[e.index])?void 0:r.current;return null==a||null==(n=a.__r3f)||null==(o=n.handlers)?void 0:o[t]({...e,object:a})}})),{})}),[e,s]),f=S.useMemo((()=>({subscribe:e=>(c((t=>[...t,e])),()=>c((t=>t.filter((t=>t.current!==e.current)))))})),[]);return S.createElement("points",b.default({matrixAutoUpdate:!1,ref:R.default([a,i])},m,n),S.createElement("bufferGeometry",null,S.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:T.DynamicDrawUsage}),S.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:T.DynamicDrawUsage}),S.createElement("bufferAttribute",{attach:"attributes-size",count:d.length,array:d,itemSize:1,usage:T.DynamicDrawUsage})),S.createElement(Wn.Provider,{value:f},e))})),$n=S.forwardRef((({children:e,...t},r)=>{S.useMemo((()=>o.extend({Position:In})),[]);const n=S.useRef(),{subscribe:a}=S.useContext(Wn);return S.useLayoutEffect((()=>a(n)),[]),S.createElement("position",b.default({ref:R.default([r,n])},t),e)})),qn=S.forwardRef((({children:e,positions:t,colors:r,sizes:n,stride:a=3,...i},s)=>{const c=S.useRef(null);return o.useFrame((()=>{const e=c.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),n&&(e.size.needsUpdate=!0)})),S.createElement("points",b.default({ref:R.default([s,c])},i),S.createElement("bufferGeometry",null,S.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:T.DynamicDrawUsage}),r&&S.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:T.DynamicDrawUsage}),n&&S.createElement("bufferAttribute",{attach:"attributes-size",count:n.length/a,array:n,itemSize:1,usage:T.DynamicDrawUsage})),e)})),Xn=S.forwardRef(((e,t)=>e.positions instanceof Float32Array?S.createElement(qn,b.default({},e,{ref:t})):S.createElement(Hn,b.default({},e,{ref:t}))));let Zn,Yn;const Kn=S.createContext(null),Qn=new T.Matrix4,Jn=new T.Matrix4,eo=new T.Matrix4;new T.Color;const to=new T.Vector3,ro=new T.Quaternion,no=new T.Vector3,oo=S.forwardRef((({context:e,children:t,...r},n)=>{S.useMemo((()=>o.extend({Position:In})),[]);const a=S.useRef(),{subscribe:i,getParent:s}=S.useContext(e||Kn);return S.useLayoutEffect((()=>i(a)),[]),S.createElement("position",b.default({instance:s(),instanceKey:a,ref:R.default([n,a])},r),t)})),ao=S.forwardRef((({children:e,range:t,limit:r=1e3,frames:n=1/0,...a},i)=>{const[{context:s,instance:c}]=S.useState((()=>{const e=S.createContext(null);return{context:e,instance:S.forwardRef(((t,r)=>S.createElement(oo,b.default({context:e},t,{ref:r}))))}})),l=S.useRef(null),[u,d]=S.useState([]),[[m,f]]=S.useState((()=>{const e=new Float32Array(16*r);for(Zn=0;Zn<r;Zn++)eo.identity().toArray(e,16*Zn);return[e,new Float32Array([...new Array(3*r)].map((()=>1)))]}));S.useEffect((()=>{l.current.instanceMatrix.needsUpdate=!0}));let p=0,h=0;o.useFrame((()=>{if(n===1/0||p<n){for(l.current.updateMatrix(),l.current.updateMatrixWorld(),Qn.copy(l.current.matrixWorld).invert(),h=Math.min(r,void 0!==t?t:r,u.length),l.current.count=h,l.current.instanceMatrix.updateRange.count=16*h,l.current.instanceColor.updateRange.count=3*h,Zn=0;Zn<u.length;Zn++)Yn=u[Zn].current,Yn.matrixWorld.decompose(to,ro,no),Jn.compose(to,ro,no).premultiply(Qn),Jn.toArray(m,16*Zn),l.current.instanceMatrix.needsUpdate=!0,Yn.color.toArray(f,3*Zn),l.current.instanceColor.needsUpdate=!0;p++}}));const v=S.useMemo((()=>({getParent:()=>l,subscribe:e=>(d((t=>[...t,e])),()=>d((t=>t.filter((t=>t.current!==e.current)))))})),[]);return S.createElement("instancedMesh",b.default({userData:{instances:u},matrixAutoUpdate:!1,ref:R.default([i,l]),args:[null,null,0],raycast:()=>null},a),S.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:m.length/16,array:m,itemSize:16,usage:T.DynamicDrawUsage}),S.createElement("instancedBufferAttribute",{attach:"instanceColor",count:f.length/3,array:f,itemSize:3,usage:T.DynamicDrawUsage}),"function"==typeof e?S.createElement(s.Provider,{value:v},e(c)):S.createElement(Kn.Provider,{value:v},e))}));const io=S.createContext(null),so=S.forwardRef(((e,t)=>{S.useMemo((()=>o.extend({SegmentObject:co})),[]);const{limit:r=1e3,lineWidth:n=1,children:a,...i}=e,[s,c]=S.useState([]),[u]=S.useState((()=>new l.Line2)),[d]=S.useState((()=>new l.LineMaterial)),[m]=S.useState((()=>new l.LineSegmentsGeometry)),[f]=S.useState((()=>new T.Vector2(512,512))),[p]=S.useState((()=>Array(6*r).fill(0))),[h]=S.useState((()=>Array(6*r).fill(0))),v=S.useMemo((()=>({subscribe:e=>(c((t=>[...t,e])),()=>c((t=>t.filter((t=>t.current!==e.current)))))})),[]);return o.useFrame((()=>{for(let t=0;t<r;t++){var e;const r=null==(e=s[t])?void 0:e.current;r&&(p[6*t+0]=r.start.x,p[6*t+1]=r.start.y,p[6*t+2]=r.start.z,p[6*t+3]=r.end.x,p[6*t+4]=r.end.y,p[6*t+5]=r.end.z,h[6*t+0]=r.color.r,h[6*t+1]=r.color.g,h[6*t+2]=r.color.b,h[6*t+3]=r.color.r,h[6*t+4]=r.color.g,h[6*t+5]=r.color.b)}m.setColors(h),m.setPositions(p),u.computeLineDistances()})),S.createElement("primitive",{object:u,ref:t},S.createElement("primitive",{object:m,attach:"geometry"}),S.createElement("primitive",b.default({object:d,attach:"material",vertexColors:!0,resolution:f,linewidth:n},i)),S.createElement(io.Provider,{value:v},a))}));class co{constructor(){this.color=new T.Color("white"),this.start=new T.Vector3(0,0,0),this.end=new T.Vector3(0,0,0)}}const lo=e=>e instanceof T.Vector3?e:new T.Vector3(..."number"==typeof e?[e,e,e]:e),uo=S.forwardRef((({color:e,start:t,end:r},n)=>{const o=S.useContext(io);if(!o)throw"Segment must used inside Segments component.";const a=S.useRef(null);return S.useLayoutEffect((()=>o.subscribe(a)),[]),S.createElement("segmentObject",{ref:R.default([a,n]),color:e,start:lo(t),end:lo(r)})})),mo=S.forwardRef((({children:e,distances:t,...r},n)=>{const a=S.useRef(null);return S.useLayoutEffect((()=>{const{current:e}=a;e.levels.length=0,e.children.forEach(((r,n)=>e.levels.push({object:r,distance:t[n]})))})),o.useFrame((e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)})),S.createElement("lOD",b.default({ref:R.default([a,n])},r),e)}));const fo=new n.Matrix4,po=new n.Ray,ho=new n.Sphere,vo=new n.Vector3;const go=t.createContext(null);const xo=S.forwardRef((({children:e,width:t,height:r,samples:n=8,renderPriority:a=0,eventPriority:i=0,frames:s=1/0,...c},l)=>{const{size:u,viewport:d}=o.useThree(),m=ur((t||u.width)*d.dpr,(r||u.height)*d.dpr,{samples:n}),[f]=S.useState((()=>new T.Scene)),p=S.useCallback(((e,t,r)=>{var n,o;let a=null==(n=m.texture)?void 0:n.__r3f.parent;for(;a&&!(a instanceof T.Object3D);)a=a.__r3f.parent;if(!a)return!1;r.raycaster.camera||r.events.compute(e,r,null==(o=r.previousRoot)?void 0:o.getState());const[i]=r.raycaster.intersectObject(a);if(!i)return!1;const s=i.uv;if(!s)return!1;t.raycaster.setFromCamera(t.pointer.set(2*s.x-1,2*s.y-1),t.camera)}),[]);return S.useImperativeHandle(l,(()=>m.texture),[m]),S.createElement(S.Fragment,null,o.createPortal(S.createElement(yo,{renderPriority:a,frames:s,fbo:m},e),f,{events:{compute:p,priority:i}}),S.createElement("primitive",b.default({object:m.texture},c)))}));function yo({frames:e,renderPriority:t,children:r,fbo:n}){let a=0;return o.useFrame((t=>{(e===1/0||a<e)&&(t.gl.setRenderTarget(n),t.gl.render(t.scene,t.camera),t.gl.setRenderTarget(null),a++)}),t),S.createElement(S.Fragment,null,r)}const wo=new T.Color;function Eo({canvasSize:e,scene:t,index:r,children:n,frames:a,rect:i,track:s}){const c=o.useThree((e=>e.get)),l=o.useThree((e=>e.camera)),u=o.useThree((e=>e.scene)),d=o.useThree((e=>e.setEvents));let m=0;return o.useFrame((r=>{var o,c;(a===1/0||m<=a)&&(i.current=null==(o=s.current)?void 0:o.getBoundingClientRect(),m++);if(i.current){const{left:o,right:a,top:s,bottom:d,width:m,height:f}=i.current,p=d<0||s>e.height||a<0||o>e.width,h=e.height-d,v=m/f;if((c=l)&&c.isOrthographicCamera?l.left===m/-2&&l.right===m/2&&l.top===f/2&&l.bottom===f/-2||(Object.assign(l,{left:m/-2,right:m/2,top:f/2,bottom:f/-2}),l.updateProjectionMatrix()):l.aspect!==v&&(l.aspect=v,l.updateProjectionMatrix()),r.gl.setViewport(o,h,m,f),r.gl.setScissor(o,h,m,f),r.gl.setScissorTest(!0),p)return r.gl.getClearColor(wo),r.gl.setClearColor(wo,r.gl.getClearAlpha()),void r.gl.clear(!0,!0);r.gl.render(n?u:t,l)}}),r),S.useEffect((()=>{const e=c().events.connected;return d({connected:s.current}),()=>d({connected:e})}),[]),S.createElement(S.Fragment,null,n)}exports.AccumulativeShadows=vn,exports.AdaptiveDpr=function({pixelated:e}){const t=o.useThree((e=>e.gl)),r=o.useThree((e=>e.internal.active)),n=o.useThree((e=>e.performance.current)),a=o.useThree((e=>e.viewport.initialDpr)),i=o.useThree((e=>e.setDpr));return S.useEffect((()=>{const n=t.domElement;return()=>{r&&i(a),e&&n&&(n.style.imageRendering="auto")}}),[]),S.useEffect((()=>{i(n*a),e&&t.domElement&&(t.domElement.style.imageRendering=1===n?"auto":"pixelated")}),[n]),null},exports.AdaptiveEvents=function(){const e=o.useThree((e=>e.get)),t=o.useThree((e=>e.setEvents)),r=o.useThree((e=>e.performance.current));return S.useEffect((()=>{const r=e().events.enabled;return()=>t({enabled:r})}),[]),S.useEffect((()=>t({enabled:1===r})),[r]),null},exports.ArcballControls=Ie,exports.BBAnchor=({anchor:e,...t})=>{const r=S.useRef(null),n=S.useRef(null);return S.useEffect((()=>{var e,t;null!=(e=r.current)&&null!=(t=e.parent)&&t.parent&&(n.current=r.current.parent,r.current.parent.parent.add(r.current))}),[]),o.useFrame((()=>{n.current&&(dr.setFromObject(n.current),dr.getSize(mr),r.current.position.set(n.current.position.x+mr.x*e[0]/2,n.current.position.y+mr.y*e[1]/2,n.current.position.z+mr.z*e[2]/2))})),S.createElement("group",b.default({ref:r},t))},exports.Backdrop=function({children:e,floor:t=.25,segments:r=20,receiveShadow:n,...o}){const a=S.useRef(null);return S.useLayoutEffect((()=>{let e=0;const n=r/r/2,o=a.current.attributes.position;for(let a=0;a<r+1;a++)for(let i=0;i<r+1;i++)o.setXYZ(e++,a/r-n+(0===a?-t:0),i/r-n,dn(a/r));o.needsUpdate=!0,a.current.computeVertexNormals()}),[r,t]),S.createElement("group",o,S.createElement("mesh",{receiveShadow:n,rotation:[-Math.PI/2,0,Math.PI/2]},S.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))},exports.BakeShadows=function(){const e=o.useThree((e=>e.gl));return t.useEffect((()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0})),[e.shadowMap]),null},exports.Billboard=te,exports.Bounds=function({children:e,damping:t=6,fit:r,clip:n,observe:a,margin:i=1.2,eps:s=.01,onFit:c}){const l=S.useRef(null),{camera:u,invalidate:d,size:m,controls:f}=o.useThree(),p=f,h=S.useRef(c);function v(e,t){return Math.abs(e.x-t.x)<s&&Math.abs(e.y-t.y)<s&&Math.abs(e.z-t.z)<s}function g(e,t,r,n){e.x=T.MathUtils.damp(e.x,t.x,r,n),e.y=T.MathUtils.damp(e.y,t.y,r,n),e.z=T.MathUtils.damp(e.z,t.z,r,n)}h.current=c;const[x]=S.useState((()=>({animating:!1,focus:new T.Vector3,camera:new T.Vector3,zoom:1}))),[y]=S.useState((()=>({focus:new T.Vector3,camera:new T.Vector3,zoom:1}))),[w]=S.useState((()=>new T.Box3)),E=S.useMemo((()=>{function e(){const e=w.getSize(new T.Vector3),t=w.getCenter(new T.Vector3),r=Math.max(e.x,e.y,e.z),n=Yr(u)?4*r:r/(2*Math.atan(Math.PI*u.fov/360)),o=Yr(u)?4*r:n/u.aspect,a=i*Math.max(n,o);return{box:w,size:e,center:t,distance:a}}return{getSize:e,refresh(t){if((r=t)&&r.isBox3)w.copy(t);else{const e=t||l.current;e.updateWorldMatrix(!0,!0),w.setFromObject(e)}var r;if(w.isEmpty()){const e=u.position.length()||10;w.setFromCenterAndSize(new T.Vector3,new T.Vector3(e,e,e))}if("OrthographicTrackballControls"===(null==p?void 0:p.constructor.name)){const{distance:t}=e(),r=u.position.clone().sub(p.target).normalize().multiplyScalar(t),n=p.target.clone().add(r);u.position.copy(n)}return this},clip(){const{distance:t}=e();return p&&(p.maxDistance=10*t),u.near=t/100,u.far=100*t,u.updateProjectionMatrix(),p&&p.update(),d(),this},fit(){x.camera.copy(u.position),p&&x.focus.copy(p.target);const{center:r,distance:n}=e(),o=r.clone().sub(u.position).normalize().multiplyScalar(n);if(y.camera.copy(r).sub(o),y.focus.copy(r),Yr(u)){x.zoom=u.zoom;let e=0,n=0;const o=[new T.Vector3(w.min.x,w.min.y,w.min.z),new T.Vector3(w.min.x,w.max.y,w.min.z),new T.Vector3(w.min.x,w.min.y,w.max.z),new T.Vector3(w.min.x,w.max.y,w.max.z),new T.Vector3(w.max.x,w.max.y,w.max.z),new T.Vector3(w.max.x,w.max.y,w.min.z),new T.Vector3(w.max.x,w.min.y,w.max.z),new T.Vector3(w.max.x,w.min.y,w.min.z)];r.applyMatrix4(u.matrixWorldInverse);for(const t of o)t.applyMatrix4(u.matrixWorldInverse),e=Math.max(e,Math.abs(t.y-r.y)),n=Math.max(n,Math.abs(t.x-r.x));e*=2,n*=2;const a=(u.top-u.bottom)/e,s=(u.right-u.left)/n;y.zoom=Math.min(a,s)/i,t||(u.zoom=y.zoom,u.updateProjectionMatrix())}return t?x.animating=!0:(u.position.copy(y.camera),u.lookAt(y.focus),p&&(p.target.copy(y.focus),p.update())),h.current&&h.current(this.getSize()),d(),this}}}),[w,u,p,i,t,d]);S.useLayoutEffect((()=>{if(p){const e=()=>x.animating=!1;return p.addEventListener("start",e),()=>p.removeEventListener("start",e)}}),[p]);const M=S.useRef(0);return S.useLayoutEffect((()=>{(a||0==M.current++)&&(E.refresh(),r&&E.fit(),n&&E.clip())}),[m,n,r,a,u,p]),o.useFrame(((e,r)=>{if(x.animating){if(g(x.focus,y.focus,t,r),g(x.camera,y.camera,t,r),x.zoom=T.MathUtils.damp(x.zoom,y.zoom,t,r),u.position.copy(x.camera),Yr(u)&&(u.zoom=x.zoom,u.updateProjectionMatrix()),p?(p.target.copy(x.focus),p.update()):u.lookAt(x.focus),d(),Yr(u)&&!(Math.abs(x.zoom-y.zoom)<s))return;if(!Yr(u)&&!v(x.camera,y.camera))return;if(p&&!v(x.focus,y.focus))return;x.animating=!1}})),S.createElement("group",{ref:l},S.createElement(Kr.Provider,{value:E},e))},exports.Box=Pr,exports.CameraShake=Qr,exports.Capsule=Gr,exports.CatmullRomLine=ie,exports.Center=Zr,exports.Circle=Rr,exports.Clone=Te,exports.Cloud=function({opacity:e=.5,speed:t=.4,width:r=10,depth:n=1.5,segments:a=20,texture:i="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",color:s="#ffffff",depthTest:c=!0,...l}){const u=o.useThree((e=>e.gl)),d=S.useRef(),m=pe(i),f=S.useMemo((()=>[...new Array(a)].map(((e,n)=>({x:r/2-Math.random()*r,y:r/2-Math.random()*r,scale:.4+Math.sin((n+1)/a*Math.PI)*(10*(.2+Math.random())),density:Math.max(.2,Math.random()),rotation:Math.max(.002,.005*Math.random())*t})))),[r,a,t]);return o.useFrame((e=>{var t;return null==(t=d.current)?void 0:t.children.forEach(((t,r)=>{t.children[0].rotation.z+=f[r].rotation,t.children[0].scale.setScalar(f[r].scale+(1+Math.sin(e.clock.getElapsedTime()/10))/2*r/10)}))})),S.createElement("group",l,S.createElement("group",{position:[0,0,a/2*n],ref:d},f.map((({x:t,y:r,scale:o,density:a},i)=>S.createElement(te,{key:i,position:[t,r,-i*n]},S.createElement(zr,{scale:o,rotation:[0,0,0]},S.createElement("meshStandardMaterial",{map:m,"map-encoding":u.outputEncoding,transparent:!0,opacity:o/6*a*e,depthTest:c,color:s})))))))},exports.ComputedAttribute=({compute:e,name:t,...r})=>{const[o]=S.useState((()=>new n.BufferAttribute(new Float32Array(0),1))),a=S.useRef(null);return S.useLayoutEffect((()=>{if(a.current){var t;const r=null!==(t=a.current.parent)&&void 0!==t?t:a.current.__r3f.parent,n=e(r);a.current.copy(n)}}),[e]),S.createElement("primitive",b.default({ref:a,object:o,attach:`attributes-${t}`},r))},exports.Cone=Dr,exports.ContactShadows=ln,exports.CubeCamera=function({children:e,fog:t,frames:r=1/0,resolution:a=256,near:i=.1,far:s=1e3,envMap:c,...l}){const u=S.useRef(),[d,m]=S.useState(null),f=o.useThree((({scene:e})=>e)),p=o.useThree((({gl:e})=>e)),h=S.useMemo((()=>{const e=new n.WebGLCubeRenderTarget(a);return e.texture.encoding=p.outputEncoding,e.texture.type=n.HalfFloatType,e}),[a]);let v,g,x=0;return o.useFrame((()=>{d&&u.current&&(r===1/0||x<r)&&(u.current.visible=!1,v=f.fog,g=f.background,f.background=c||g,f.fog=t||v,d.update(p,f),f.fog=v,f.background=g,u.current.visible=!0,x++)})),S.createElement("group",l,S.createElement("cubeCamera",{ref:m,args:[i,s,h]}),S.createElement("group",{ref:u},e(h.texture)))},exports.CubicBezierLine=ae,exports.CurveModifier=fr,exports.CycleRaycast=function({onChanged:e,portal:t,preventDefault:r=!0,scroll:n=!0,keyCode:a=9}){const i=S.useRef(0),s=o.useThree((e=>e.setEvents)),c=o.useThree((e=>e.get)),l=o.useThree((e=>e.gl));return S.useEffect((()=>{var o;let u,d=[];const m=c().events.filter,f=null!==(o=null==t?void 0:t.current)&&void 0!==o?o:l.domElement.parentNode,p=()=>f&&e&&e(d,Math.round(i.current)%d.length);s({filter:(e,t)=>{let r=[...e];r.length===d.length&&d.every((e=>r.map((e=>e.object.uuid)).includes(e.object.uuid)))||(i.current=0,d=r,p()),m&&(r=m(r,t));for(let e=0;e<Math.round(i.current)%r.length;e++){const e=r.shift();r=[...r,e]}return r}});const h=e=>{var t,r;i.current=e(i.current),null==(t=c().events.handlers)||t.onPointerCancel(void 0),null==(r=c().events.handlers)||r.onPointerMove(u),p()},v=e=>{(e.keyCode||e.which===a)&&(r&&e.preventDefault(),d.length>1&&h((e=>e+1)))},g=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),d.length>1&&h((e=>Math.abs(e-t)))},x=e=>u=e;return document.addEventListener("pointermove",x,{passive:!0}),n&&document.addEventListener("wheel",g),void 0!==a&&document.addEventListener("keydown",v),()=>{s({filter:m}),void 0!==a&&document.removeEventListener("keydown",v),n&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",x)}}),[l,c,s,r,n,a]),null},exports.Cylinder=_r,exports.Decal=function({debug:e,mesh:t,children:r,position:n,rotation:a,scale:i,...s}){const c=S.useRef(null),u=S.useRef(null);return S.useLayoutEffect((()=>{const e=(null==t?void 0:t.current)||c.current.parent,r=c.current;if(!(e instanceof T.Mesh))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const s={position:new T.Vector3,rotation:new T.Euler,scale:new T.Vector3(1,1,1)};if(e){o.applyProps(s,{position:n,scale:i});const t=e.matrixWorld.clone();if(e.matrixWorld.identity(),a&&"number"!=typeof a)o.applyProps(s,{rotation:a});else{const t=new T.Object3D;t.position.copy(s.position),t.lookAt(e.position),"number"==typeof a&&t.rotateZ(a),o.applyProps(s,{rotation:t.rotation})}return r.geometry=new l.DecalGeometry(e,s.position,s.rotation,s.scale),u.current&&o.applyProps(u.current,s),e.matrixWorld=t,()=>{r.geometry.dispose()}}}),[t,...Le(n),...Le(i),...Le(a)]),S.createElement("mesh",{ref:c},r||S.createElement("meshStandardMaterial",b.default({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},s)),e&&S.createElement("mesh",{ref:u},S.createElement("boxGeometry",null),S.createElement("meshNormalMaterial",{wireframe:!0}),S.createElement("axesHelper",null)))},exports.Detailed=mo,exports.DeviceOrientationControls=Ae,exports.Dodecahedron=jr,exports.Edges=function({userData:e,children:t,geometry:r,threshold:n=15,color:o="black",...a}){const i=S.useRef(null);return S.useLayoutEffect((()=>{const e=i.current.parent;if(e){const t=r||e.geometry;t===i.current.userData.currentGeom&&n===i.current.userData.currentThreshold||(i.current.userData.currentGeom=t,i.current.userData.currentThreshold=n,i.current.geometry=new T.EdgesGeometry(t,n))}})),S.createElement("lineSegments",b.default({ref:i,raycast:()=>null},a),t||S.createElement("lineBasicMaterial",{color:o}))},exports.Effects=de,exports.Environment=cn,exports.EnvironmentCube=on,exports.EnvironmentMap=rn,exports.EnvironmentPortal=an,exports.Extrude=Wr,exports.FirstPersonControls=We,exports.Float=Jr,exports.FlyControls=ke,exports.GizmoHelper=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=0,autoClear:a=!0,onUpdate:i,onTarget:s,children:c})=>{const l=o.useThree((({size:e})=>e)),u=o.useThree((({camera:e})=>e)),d=o.useThree((({controls:e})=>e)),m=o.useThree((({gl:e})=>e)),f=o.useThree((({scene:e})=>e)),p=o.useThree((({invalidate:e})=>e)),h=S.useRef(),v=S.useRef(),g=S.useRef(null),[x]=S.useState((()=>new n.Scene)),y=S.useRef(!1),w=S.useRef(0),E=S.useRef(new n.Vector3(0,0,0)),M=S.useRef(new n.Vector3(0,0,0));S.useEffect((()=>{M.current.copy(u.up)}),[u]);const b=S.useCallback((e=>{y.current=!0,(d||s)&&(E.current=(null==d?void 0:d.target)||(null==s?void 0:s())),w.current=u.position.distanceTo(It),Ut.copy(u.quaternion),Ot.copy(e).multiplyScalar(w.current).add(It),kt.lookAt(Ot),Vt.copy(kt.quaternion),p()}),[d,u,s,p]);S.useEffect((()=>(f.background&&(h.current=f.background,f.background=null,x.background=h.current),()=>{h.current&&(f.background=h.current)})),[]),o.useFrame(((e,t)=>{if(g.current&&v.current){var r;if(y.current)if(Ut.angleTo(Vt)<.01)y.current=!1,u.up.copy(M.current);else{const e=t*At;Ut.rotateTowards(Vt,e),u.position.set(0,0,1).applyQuaternion(Ut).multiplyScalar(w.current).add(E.current),u.up.set(0,1,0).applyQuaternion(Ut).normalize(),u.quaternion.copy(Ut),i?i():d&&d.update(),p()}Bt.copy(u.matrix).invert(),null==(r=v.current)||r.quaternion.setFromRotationMatrix(Bt),a&&(m.autoClear=!1),m.clearDepth(),m.render(x,g.current)}}),r);const C=Lt(g),T=S.useMemo((()=>({tweenCamera:b,raycast:C})),[b]),[P,R]=t,D=e.endsWith("-center")?0:e.endsWith("-left")?-l.width/2+P:l.width/2-P,_=e.startsWith("center-")?0:e.startsWith("top-")?l.height/2-R:-l.height/2+R;return o.createPortal(S.createElement(zt.Provider,{value:T},S.createElement(ze,{ref:g,position:[0,0,200]}),S.createElement("group",{ref:v,position:[D,_,0]},c)),x)},exports.GizmoViewcube=e=>S.createElement("group",{scale:[60,60,60]},S.createElement(Qt,e),Zt.map(((t,r)=>S.createElement(Jt,b.default({key:r,position:t,dimensions:Yt[r]},e)))),qt.map(((t,r)=>S.createElement(Jt,b.default({key:r,position:t,dimensions:Xt},e)))),S.createElement("ambientLight",{intensity:.5}),S.createElement("pointLight",{position:[10,10,10],intensity:.5})),exports.GizmoViewport=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:n="18px Inter var, Arial, sans-serif",axisColors:o=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:i,labels:s=["X","Y","Z"],labelColor:c="#000",onClick:l,...u})=>{const[d,m,f]=o,{tweenCamera:p,raycast:h}=Ft(),v={font:n,disabled:r,labelColor:c,raycast:h,onClick:l,axisHeadScale:a,onPointerDown:r?void 0:e=>{p(e.object.position),e.stopPropagation()}};return S.createElement("group",b.default({scale:40},u),S.createElement(er,{color:d,rotation:[0,0,0],scale:i}),S.createElement(er,{color:m,rotation:[0,0,Math.PI/2],scale:i}),S.createElement(er,{color:f,rotation:[0,-Math.PI/2,0],scale:i}),!t&&S.createElement(S.Fragment,null,S.createElement(tr,b.default({arcStyle:d,position:[1,0,0],label:s[0]},v)),S.createElement(tr,b.default({arcStyle:m,position:[0,1,0],label:s[1]},v)),S.createElement(tr,b.default({arcStyle:f,position:[0,0,1],label:s[2]},v)),!e&&S.createElement(S.Fragment,null,S.createElement(tr,b.default({arcStyle:d,position:[-1,0,0]},v)),S.createElement(tr,b.default({arcStyle:m,position:[0,-1,0]},v)),S.createElement(tr,b.default({arcStyle:f,position:[0,0,-1]},v)))),S.createElement("ambientLight",{intensity:.5}),S.createElement("pointLight",{position:[10,10,10],intensity:.5}))},exports.GradientTexture=function({stops:e,colors:t,size:r=1024,...n}){const a=o.useThree((e=>e.gl)),i=S.useMemo((()=>{const n=document.createElement("canvas"),o=n.getContext("2d");n.width=16,n.height=r;const a=o.createLinearGradient(0,0,0,r);let i=e.length;for(;i--;)a.addColorStop(e[i],t[i]);o.fillStyle=a,o.fillRect(0,0,16,r);const s=new T.Texture(n);return s.needsUpdate=!0,s}),[e]);return S.useEffect((()=>()=>{i.dispose()}),[i]),S.createElement("primitive",b.default({object:i,attach:"map",encoding:a.outputEncoding},n))},exports.Html=G,exports.Icosahedron=Ir,exports.Image=ye,exports.Instance=oo,exports.Instances=ao,exports.IsObject=fe,exports.Lathe=Nr,exports.Lightformer=bn,exports.Line=re,exports.Loader=function({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:n,dataInterpolation:o=q,initialState:a=(e=>e)}){const{active:i,progress:s}=$(),c=S.useRef(0),l=S.useRef(0),u=S.useRef(null),[d,m]=S.useState(a(i));S.useEffect((()=>{let e;return i!==d&&(e=setTimeout((()=>m(i)),300)),()=>clearTimeout(e)}),[d,i]);const f=S.useCallback((()=>{u.current&&(c.current+=(s-c.current)/2,(c.current>.95*s||100===s)&&(c.current=s),u.current.innerText=o(c.current),c.current<s&&(l.current=requestAnimationFrame(f)))}),[o,s]);return S.useEffect((()=>(f(),()=>cancelAnimationFrame(l.current))),[f]),d?S.createElement("div",{style:{...X.container,opacity:i?1:0,...e}},S.createElement("div",null,S.createElement("div",{style:{...X.inner,...t}},S.createElement("div",{style:{...X.bar,transform:`scaleX(${s/100})`,...r}}),S.createElement("span",{ref:u,style:{...X.data,...n}})))):null},exports.MapControls=Be,exports.MarchingCube=De,exports.MarchingCubes=Re,exports.MarchingPlane=_e,exports.Mask=function({id:e=1,children:t,colorWrite:r=!1,depthWrite:n=!1,...o}){const a=S.useMemo((()=>({colorWrite:r,depthWrite:n,stencilWrite:!0,stencilRef:e,stencilFunc:T.AlwaysStencilFunc,stencilFail:T.ReplaceStencilOp,stencilZFail:T.ReplaceStencilOp,stencilZPass:T.ReplaceStencilOp})),[e,r,n]);return S.createElement("mesh",b.default({renderOrder:-e},o),S.createElement("meshBasicMaterial",a),"function"==typeof t?t(a):t)},exports.Merged=function({meshes:e,children:t,...r}){const n=Array.isArray(e);if(!n)for(const t of Object.keys(e))e[t].isMesh||delete e[t];return S.createElement(A.default,{components:(n?e:Object.values(e)).map((({geometry:e,material:t})=>S.createElement(ao,b.default({key:e.uuid,geometry:e,material:t},r))))},(r=>n?t(...r):t(Object.keys(e).filter((t=>e[t].isMesh)).reduce(((e,t,n)=>({...e,[t]:r[n]})),{}))))},exports.MeshDistortMaterial=hr,exports.MeshReflectorMaterial=Er,exports.MeshRefractionMaterial=function({aberrationStrength:e=0,fastChroma:r=!0,envMap:n,...a}){o.extend({MeshRefractionMaterial:Mr});const i=t.useRef(),{size:s}=o.useThree(),c=t.useMemo((()=>{var t,o;const a={},i=(s=n)&&s.isCubeTexture;var s;const c=(null!==(t=i?null==(o=n.image[0])?void 0:o.width:n.image.width)&&void 0!==t?t:1024)/4,l=Math.floor(Math.log2(c)),u=Math.pow(2,l),d=3*Math.max(u,112),m=4*u;return i&&(a.ENVMAP_TYPE_CUBEM=""),a.CUBEUV_TEXEL_WIDTH=""+1/d,a.CUBEUV_TEXEL_HEIGHT=""+1/m,a.CUBEUV_MAX_MIP=`${l}.0`,e>0&&(a.CHROMATIC_ABERRATIONS=""),r&&(a.FAST_CHROMA=""),a}),[e,r]);return t.useLayoutEffect((()=>{var e,t,r;const n=null==(e=i.current)||null==(t=e.__r3f)||null==(r=t.parent)?void 0:r.geometry;n&&i.current.bvh.updateFrom(new y.MeshBVH(n.toNonIndexed(),{lazyGeneration:!1,strategy:y.SAH}))}),[]),S.createElement("meshRefractionMaterial",b.default({key:JSON.stringify(c),defines:c,ref:i,resolution:[s.width,s.height],aberrationStrength:e,envMap:n},a))},exports.MeshWobbleMaterial=gr,exports.Octahedron=Or,exports.OrbitControls=Ue,exports.OrthographicCamera=ze,exports.PerformanceMonitor=function({iterations:e=10,ms:r=250,threshold:n=.75,step:a=.1,factor:i=.5,flipflops:s=1/0,bounds:c=(e=>e>100?[60,100]:[40,60]),onIncline:l,onDecline:u,onChange:d,onFallback:m,children:f}){const p=Math.pow(10,0),[h,v]=t.useState((()=>({fps:0,index:0,factor:i,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{const t=Symbol();return h.subscriptions.set(t,e.current),()=>{h.subscriptions.delete(t)}}})));let g=0;return o.useFrame((()=>{const{frames:t,averages:o}=h;if(!h.fallback&&o.length<e){t.push(performance.now());const i=t[t.length-1]-t[0];if(i>=r){if(h.fps=Math.round(t.length/i*1e3*p)/p,h.refreshrate=Math.max(h.refreshrate,h.fps),o[h.index++%e]=h.fps,o.length===e){const[t,r]=c(h.refreshrate),i=o.filter((e=>e>=r)),f=o.filter((e=>e<t));i.length>e*n&&(h.factor=Math.min(1,h.factor+a),h.flipped++,l&&l(h),h.subscriptions.forEach((e=>e.onIncline&&e.onIncline(h)))),f.length>e*n&&(h.factor=Math.max(0,h.factor-a),h.flipped++,u&&u(h),h.subscriptions.forEach((e=>e.onDecline&&e.onDecline(h)))),g!==h.factor&&(g=h.factor,d&&d(h),h.subscriptions.forEach((e=>e.onChange&&e.onChange(h)))),h.flipped>s&&!h.fallback&&(h.fallback=!0,m&&m(h),h.subscriptions.forEach((e=>e.onFallback&&e.onFallback(h)))),h.averages=[]}h.frames=[]}}})),S.createElement(go.Provider,{value:h},f)},exports.PerspectiveCamera=Fe,exports.PivotControls=_t,exports.Plane=zr,exports.Point=$n,exports.PointMaterial=Sr,exports.PointMaterialImpl=br,exports.PointerLockControls=je,exports.Points=Xn,exports.PointsBuffer=qn,exports.Polyhedron=Vr,exports.PositionalAudio=se,exports.Preload=function({all:e,scene:t,camera:r}){const a=o.useThree((({gl:e})=>e)),i=o.useThree((({camera:e})=>e)),s=o.useThree((({scene:e})=>e));return S.useLayoutEffect((()=>{const o=[];e&&(t||s).traverse((e=>{!1===e.visible&&(o.push(e),e.visible=!0)})),a.compile(t||s,r||i);const c=new n.WebGLCubeRenderTarget(128);new n.CubeCamera(.01,1e5,c).update(a,t||s),c.dispose(),o.forEach((e=>e.visible=!1))}),[]),null},exports.PresentationControls=function({snap:e,global:t,cursor:r=!0,children:a,speed:i=1,rotation:l=[0,0,0],zoom:u=1,polar:d=[0,Math.PI/2],azimuth:m=[-1/0,1/0],config:f={mass:1,tension:170,friction:26}}){const{size:p,gl:h}=o.useThree(),v=S.useMemo((()=>[l[0]+d[0],l[0]+d[1]]),[l[0],d[0],d[1]]),g=S.useMemo((()=>[l[1]+m[0],l[1]+m[1]]),[l[1],m[0],m[1]]),x=S.useMemo((()=>[n.MathUtils.clamp(l[0],...v),n.MathUtils.clamp(l[1],...g),l[2]]),[l[0],l[1],l[2],v,g]),[y,w]=s.useSpring((()=>({scale:1,rotation:x,config:f})));S.useEffect((()=>{w.start({scale:1,rotation:x,config:f})}),[x]),S.useEffect((()=>{t&&r&&(h.domElement.style.cursor="grab")}),[t,r,h.domElement]);const E=c.useGesture({onHover:({last:e})=>{r&&!t&&(h.domElement.style.cursor=e?"auto":"grab")},onDrag:({down:t,delta:[o,a],memo:[s,c]=y.rotation.animation.to||x})=>{r&&(h.domElement.style.cursor=t?"grabbing":"grab"),o=n.MathUtils.clamp(c+o/p.width*Math.PI*i,...g),a=n.MathUtils.clamp(s+a/p.height*Math.PI*i,...v);const l=e&&!t&&"boolean"!=typeof e?e:f;return w.start({scale:t&&a>v[1]/2?u:1,rotation:e&&!t?x:[a,o,0],config:e=>"scale"===e?{...l,friction:3*l.friction}:l}),[a,o]}},{target:t?h.domElement:void 0});return S.createElement(s.a.group,b.default({},null==E?void 0:E(),y),a)},exports.QuadraticBezierLine=oe,exports.RandomizedLight=gn,exports.Reflector=yn,exports.RenderTexture=xo,exports.Ring=Ur,exports.RoundedBox=$r,exports.Sampler=function({children:e,weight:t,transform:r,instances:n,mesh:o,count:a=16,...i}){const s=S.useRef(null),c=S.useRef(null),l=S.useRef(null);return S.useEffect((()=>{var e,t;c.current=null!==(e=null==n?void 0:n.current)&&void 0!==e?e:s.current.children.find((e=>e.hasOwnProperty("instanceMatrix"))),l.current=null!==(t=null==o?void 0:o.current)&&void 0!==t?t:s.current.children.find((e=>"Mesh"===e.type))}),[e,null==o?void 0:o.current,null==n?void 0:n.current]),Se(l,a,r,t,c),S.createElement("group",b.default({ref:s},i),e)},exports.ScreenQuad=Xr,exports.Scroll=J,exports.ScrollControls=function({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:n,pages:a=1,distance:i=1,damping:s=4,style:c={},children:l}){const{get:u,setEvents:d,gl:m,size:f,invalidate:p,events:h}=o.useThree(),[v]=S.useState((()=>document.createElement("div"))),[g]=S.useState((()=>document.createElement("div"))),[x]=S.useState((()=>document.createElement("div"))),y=m.domElement.parentNode,w=S.useRef(0),E=S.useMemo((()=>{const t={el:v,eps:e,fill:g,fixed:x,horizontal:n,damping:s,offset:0,delta:0,scroll:w,pages:a,range(e,t,r=0){const n=e-r,o=n+t+2*r;return this.offset<n?0:this.offset>o?1:(this.offset-n)/(o-n)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){const n=e-r,o=n+t+2*r;return this.offset>=n&&this.offset<=o}};return t}),[e,s,n,a]);S.useEffect((()=>{v.style.position="absolute",v.style.width="100%",v.style.height="100%",v.style[n?"overflowX":"overflowY"]="auto",v.style[n?"overflowY":"overflowX"]="hidden",v.style.top="0px",v.style.left="0px";for(const e in c)v.style[e]=c[e];x.style.position="sticky",x.style.top="0px",x.style.left="0px",x.style.width="100%",x.style.height="100%",x.style.overflow="hidden",v.appendChild(x),g.style.height=n?"100%":a*i*100+"%",g.style.width=n?a*i*100+"%":"100%",g.style.pointerEvents="none",v.appendChild(g),y.appendChild(v),v[n?"scrollLeft":"scrollTop"]=1;const e=h.connected||m.domElement;requestAnimationFrame((()=>null==h.connect?void 0:h.connect(v)));const t=u().events.compute;return d({compute(e,t){const r=e.clientX-y.offsetLeft,n=e.clientY-y.offsetTop;t.pointer.set(r/t.size.width*2-1,-n/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{y.removeChild(v),d({compute:t}),null==h.connect||h.connect(e)}}),[a,i,n,v,g,x,y]),S.useEffect((()=>{if(h.connected===v){const e=f[n?"width":"height"],o=v[n?"scrollWidth":"scrollHeight"],a=o-e;let i=0,s=!0,c=!0;const l=()=>{if(t&&!c&&(p(),i=v[n?"scrollLeft":"scrollTop"],w.current=i/a,r)){if(!s)if(i>=a){const e=1-E.offset;v[n?"scrollLeft":"scrollTop"]=1,w.current=E.offset=-e,s=!0}else if(i<=0){const e=1+E.offset;v[n?"scrollLeft":"scrollTop"]=o,w.current=E.offset=e,s=!0}s&&setTimeout((()=>s=!1),40)}};v.addEventListener("scroll",l,{passive:!0}),requestAnimationFrame((()=>c=!1));const u=e=>v.scrollLeft+=e.deltaY/2;return n&&v.addEventListener("wheel",u,{passive:!0}),()=>{v.removeEventListener("scroll",l),n&&v.removeEventListener("wheel",u)}}}),[v,h,f,r,E,p,n,t]);let M=0;return o.useFrame(((t,r)=>{E.offset=T.MathUtils.damp(M=E.offset,w.current,s,r),E.delta=T.MathUtils.damp(E.delta,Math.abs(M-E.offset),s,r),E.delta>e&&p()})),S.createElement(Z.Provider,{value:E},l)},exports.Segment=uo,exports.SegmentObject=co,exports.Segments=so,exports.Select=function({box:e,multiple:t,children:r,onChange:n,border:a="1px solid #55aaff",backgroundColor:i="rgba(75, 160, 255, 0.1)",filter:s=(e=>e),...c}){const{setEvents:u,camera:d,raycaster:m,gl:f,controls:p,size:h,get:v}=o.useThree(),[g,x]=S.useState(!1),[y,w]=S.useReducer(((e,{object:t,shift:r})=>void 0===t?[]:Array.isArray(t)?t:r?e.includes(t)?e.filter((e=>e!==t)):[t,...e]:e[0]===t?[]:[t]),[]);S.useEffect((()=>{null==n||n(y)}),[y]);const E=S.useCallback((e=>{e.stopPropagation(),w({object:s([e.object])[0],shift:t&&e.shiftKey})}),[]),M=S.useCallback((e=>!g&&w({})),[g]),C=S.useRef(null);return S.useEffect((()=>{if(!e||!t)return;const r=new l.SelectionBox(d,C.current),n=document.createElement("div");n.style.pointerEvents="none",n.style.border=a,n.style.backgroundColor=i,n.style.position="fixed";const o=new T.Vector2,c=new T.Vector2,m=new T.Vector2,g=v().events.enabled,x=null==p?void 0:p.enabled;let y=!1;function E(e,t){const{offsetX:r,offsetY:n}=e,{width:o,height:a}=h;t.set(r/o*2-1,-n/a*2+1)}function M(e){e.shiftKey&&(!function(e){var t;p&&(p.enabled=!1),u({enabled:!1}),y=!0,null==(t=f.domElement.parentElement)||t.appendChild(n),n.style.left=`${e.clientX}px`,n.style.top=`${e.clientY}px`,n.style.width="0px",n.style.height="0px",o.x=e.clientX,o.y=e.clientY}(e),E(e,r.startPoint))}let b=[];function S(e){if(y){!function(e){m.x=Math.max(o.x,e.clientX),m.y=Math.max(o.y,e.clientY),c.x=Math.min(o.x,e.clientX),c.y=Math.min(o.y,e.clientY),n.style.left=`${c.x}px`,n.style.top=`${c.y}px`,n.style.width=m.x-c.x+"px",n.style.height=m.y-c.y+"px"}(e),E(e,r.endPoint);const t=r.select().sort((e=>e.uuid)).filter((e=>e.isMesh));D.default(t,b)||(b=t,w({object:s(t)}))}}function P(e){var t;y&&y&&(p&&(p.enabled=x),u({enabled:g}),y=!1,null==(t=n.parentElement)||t.removeChild(n))}return document.addEventListener("pointerdown",M,{passive:!0}),document.addEventListener("pointermove",S,{passive:!0,capture:!0}),document.addEventListener("pointerup",P,{passive:!0}),()=>{document.removeEventListener("pointerdown",M),document.removeEventListener("pointermove",S),document.removeEventListener("pointerup",P)}}),[h,m,d,p,f]),S.createElement("group",b.default({ref:C,onClick:E,onPointerOver:()=>x(!0),onPointerOut:()=>x(!1),onPointerMissed:M},c),S.createElement(ee.Provider,{value:y},r))},exports.Shadow=mn,exports.Sky=Cn,exports.Sparkles=An,exports.Sphere=Lr,exports.SpotLight=Mn,exports.Stage=function({children:e,controls:t,shadows:r=!0,adjustCamera:n=!0,environment:a="city",intensity:i=1,preset:s="rembrandt",shadowBias:c=0,contactShadow:l={blur:2,opacity:.5,position:[0,0,0]},...u}){const d=un[s],m=o.useThree((e=>e.camera)),f=o.useThree((e=>e.controls)),p=S.useRef(null),h=S.useRef(null),[{radius:v,width:g,height:x},y]=S.useState({radius:0,width:0,height:0});return S.useLayoutEffect((()=>{p.current.position.set(0,0,0),p.current.updateWorldMatrix(!0,!0);const e=(new T.Box3).setFromObject(h.current),t=new T.Vector3,r=new T.Sphere,n=e.max.y-e.min.y,o=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),y({radius:r.radius,width:o,height:n}),p.current.position.set(-t.x,-t.y+n/2,-t.z)}),[e]),S.useLayoutEffect((()=>{if(n){const e=v/(x>g?1.5:2.5);m.position.set(0,.5*v,2.5*v),m.near=.1,m.far=Math.max(5e3,4*v),m.lookAt(0,e,0);const r=f||(null==t?void 0:t.current);r&&(r.target.set(0,e,0),r.update())}}),[f,v,x,g,n]),S.createElement("group",u,S.createElement("group",{ref:p},S.createElement("group",{ref:h},e)),l&&S.createElement(ln,b.default({scale:2*v,far:v/2},l)),a&&S.createElement(cn,{preset:a}),S.createElement("ambientLight",{intensity:i/3}),S.createElement("spotLight",{penumbra:1,position:[d.main[0]*v,d.main[1]*v,d.main[2]*v],intensity:2*i,castShadow:r,"shadow-bias":c}),S.createElement("pointLight",{position:[d.fill[0]*v,d.fill[1]*v,d.fill[2]*v],intensity:i}))},exports.Stars=Rn,exports.Stats=function({showPanel:e=0,className:t,parent:r}){const n=function(e,t=[],r){const[n,o]=S.useState();return S.useLayoutEffect((()=>{const t=e();return o(t),lr(r,t),()=>lr(r,null)}),t),n}((()=>new F.default),[]);return S.useEffect((()=>{if(n){const a=r&&r.current||document.body;n.showPanel(e),null==a||a.appendChild(n.dom),t&&n.dom.classList.add(...t.split(" ").filter((e=>e)));const i=o.addEffect((()=>n.begin())),s=o.addAfterEffect((()=>n.end()));return()=>{null==a||a.removeChild(n.dom),i(),s()}}}),[r,n,t,e]),null},exports.Tetrahedron=Br,exports.Text=ce,exports.Text3D=ue,exports.Torus=Ar,exports.TorusKnot=kr,exports.TrackballControls=Ve,exports.Trail=be,exports.TransformControls=Oe,exports.Tube=Fr,exports.View=({track:e,index:t=1,frames:r=1/0,children:n})=>{const a=S.useRef(null),{size:i,scene:s}=o.useThree(),[c]=S.useState((()=>new T.Scene)),l=S.useCallback(((t,r)=>{if(e.current&&t.target===e.current){const{width:e,height:n,left:o,top:i}=a.current,s=t.clientX-o,c=t.clientY-i;r.pointer.set(s/e*2-1,-c/n*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}}),[a]),[u,d]=S.useReducer((()=>!0),!1);return S.useEffect((()=>{var t;a.current=null==(t=e.current)?void 0:t.getBoundingClientRect(),d()}),[]),u&&o.createPortal(S.createElement(Eo,{canvasSize:i,frames:r,scene:s,track:e,rect:a,index:t},n),c,{events:{compute:l,priority:t},size:{width:a.current.width,height:a.current.height}})},exports.accumulativeContext=fn,exports.calcPosFromAngles=Sn,exports.calculateScaleFactor=mt,exports.isWebGL2Available=()=>{try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},exports.meshBounds=function(e,t){const r=this.geometry,n=this.material,o=this.matrixWorld;void 0!==n&&(null===r.boundingSphere&&r.computeBoundingSphere(),ho.copy(r.boundingSphere),ho.applyMatrix4(o),!1!==e.ray.intersectsSphere(ho)&&(fo.copy(o).invert(),po.copy(e.ray).applyMatrix4(fo),null!==r.boundingBox&&null===po.intersectBox(r.boundingBox,vo)||t.push({distance:vo.distanceTo(e.ray.origin),point:vo.clone(),object:this})))},exports.shaderMaterial=me,exports.softShadows=e=>{if(!Cr){Cr=!0;let t=T.ShaderChunk.shadowmap_pars_fragment;t=t.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({frustum:e=3.75,size:t=.005,near:r=9.5,samples:n=17,rings:o=11}={})=>`#define LIGHT_WORLD_SIZE ${t}\n#define LIGHT_FRUSTUM_WIDTH ${e}\n#define LIGHT_SIZE_UV (LIGHT_WORLD_SIZE / LIGHT_FRUSTUM_WIDTH)\n#define NEAR_PLANE ${r}\n\n#define NUM_SAMPLES ${n}\n#define NUM_RINGS ${o}\n#define BLOCKER_SEARCH_NUM_SAMPLES NUM_SAMPLES\n#define PCF_NUM_SAMPLES NUM_SAMPLES\n\nvec2 poissonDisk[NUM_SAMPLES];\n\nvoid initPoissonSamples(const in vec2 randomSeed) {\n  float ANGLE_STEP = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n  float INV_NUM_SAMPLES = 1.0 / float(NUM_SAMPLES);\n  float angle = rand(randomSeed) * PI2;\n  float radius = INV_NUM_SAMPLES;\n  float radiusStep = radius;\n  for (int i = 0; i < NUM_SAMPLES; i++) {\n    poissonDisk[i] = vec2(cos(angle), sin(angle)) * pow(radius, 0.75);\n    radius += radiusStep;\n    angle += ANGLE_STEP;\n  }\n}\n\nfloat penumbraSize(const in float zReceiver, const in float zBlocker) { // Parallel plane estimation\n  return (zReceiver - zBlocker) / zBlocker;\n}\n\nfloat findBlocker(sampler2D shadowMap, const in vec2 uv, const in float zReceiver) {\n  float searchRadius = LIGHT_SIZE_UV * (zReceiver - NEAR_PLANE) / zReceiver;\n  float blockerDepthSum = 0.0;\n  int numBlockers = 0;\n  for (int i = 0; i < BLOCKER_SEARCH_NUM_SAMPLES; i++) {\n    float shadowMapDepth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));\n    if (shadowMapDepth < zReceiver) {\n      blockerDepthSum += shadowMapDepth;\n      numBlockers++;\n    }\n  }\n  if (numBlockers == 0) return -1.0;\n  return blockerDepthSum / float(numBlockers);\n}\n\nfloat PCF_Filter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius) {\n  float sum = 0.0;\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + poissonDisk[ i ] * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  for (int i = 0; i < PCF_NUM_SAMPLES; i++) {\n    float depth = unpackRGBAToDepth(texture2D(shadowMap, uv + -poissonDisk[ i ].yx * filterRadius));\n    if (zReceiver <= depth) sum += 1.0;\n  }\n  return sum / (2.0 * float(PCF_NUM_SAMPLES));\n}\n\nfloat PCSS(sampler2D shadowMap, vec4 coords) {\n  vec2 uv = coords.xy;\n  float zReceiver = coords.z; // Assumed to be eye-space z in this code\n  initPoissonSamples(uv);\n  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver);\n  if (avgBlockerDepth == -1.0) return 1.0;\n  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);\n  float filterRadius = penumbraRatio * LIGHT_SIZE_UV * NEAR_PLANE / zReceiver;\n  return PCF_Filter(shadowMap, uv, zReceiver, filterRadius);\n}`)({...e})),t=t.replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),T.ShaderChunk.shadowmap_pars_fragment=t}},exports.useAnimations=function(e,t){const r=S.useRef(),[a]=S.useState((()=>t?t instanceof n.Object3D?{current:t}:t:r)),[i]=S.useState((()=>new n.AnimationMixer(void 0))),s=S.useRef({}),[c]=S.useState((()=>{const t={};return e.forEach((e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(a.current)return s.current[e.name]||(s.current[e.name]=i.clipAction(e,a.current))}}))),{ref:a,clips:e,actions:t,names:e.map((e=>e.name)),mixer:i}}));return o.useFrame(((e,t)=>i.update(t))),S.useEffect((()=>{const e=a.current;return()=>{s.current={},Object.values(c.actions).forEach((t=>{e&&i.uncacheAction(t,e)}))}}),[e]),c},exports.useAspect=function(e,t,r=1){const n=o.useThree((e=>e.viewport)),a=t*(n.aspect>e/t?n.width/e:n.height/t);return[e*(n.aspect>e/t?n.width/e:n.height/t)*r,a*r,1]},exports.useBVH=function(e,t){S.useEffect((()=>{if(e.current){e.current.raycast=y.acceleratedRaycast;const r=e.current.geometry;return r.computeBoundsTree=y.computeBoundsTree,r.disposeBoundsTree=y.disposeBoundsTree,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}}),[e,t])},exports.useBounds=function(){return S.useContext(Kr)},exports.useBoxProjectedEnv=function(e=new T.Vector3,t=new T.Vector3){const[r]=S.useState((()=>({position:new T.Vector3,size:new T.Vector3})));o.applyProps(r,{position:e,size:t});const n=S.useRef(null),a=S.useMemo((()=>({ref:n,onBeforeCompile:e=>function(e,t,r){e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:r},e.vertexShader=`\n  varying vec3 vWorldPosition;\n  ${e.vertexShader.replace("#include <worldpos_vertex>","\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n  #ifdef BOX_PROJECTED_ENV_MAP\n    vWorldPosition = worldPosition.xyz;\n  #endif\n#endif\n")}`,e.fragmentShader=`\n    \n#ifdef BOX_PROJECTED_ENV_MAP\n  uniform vec3 envMapSize;\n  uniform vec3 envMapPosition;\n  varying vec3 vWorldPosition;\n    \n  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {\n    vec3 nDir = normalize( v );\n    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;\n    vec3 rbminmax;\n    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;\n    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;\n    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;\n    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );\n    vec3 boxIntersection = vWorldPosition + nDir * correction;    \n    return boxIntersection - cubePos;\n  }\n#endif\n\n    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",T.ShaderChunk.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );","vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n         \n#ifdef BOX_PROJECTED_ENV_MAP\n  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );\n#endif\n\n         ").replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );","reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n         \n#ifdef BOX_PROJECTED_ENV_MAP\n  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );\n#endif\n\n        ")}`}(e,r.position,r.size),customProgramCacheKey:()=>JSON.stringify(r.position.toArray())+JSON.stringify(r.size.toArray())})),[...r.position.toArray(),...r.size.toArray()]);return S.useLayoutEffect((()=>{n.current.needsUpdate=!0}),[r]),a},exports.useCamera=Lt,exports.useContextBridge=function(...e){const t=S.useRef([]);return t.current=e.map((e=>S.useContext(e))),S.useMemo((()=>({children:r})=>e.reduceRight(((e,r,n)=>S.createElement(r.Provider,{value:t.current[n],children:e})),r)),[])},exports.useCubeTexture=rr,exports.useCursor=function(e,t="pointer",r="auto"){S.useEffect((()=>{if(e)return document.body.style.cursor=t,()=>{document.body.style.cursor=r}}),[e])},exports.useDepthBuffer=function({size:e=256,frames:t=1/0}={}){const r=o.useThree((e=>e.viewport.dpr)),{width:a,height:i}=o.useThree((e=>e.size)),s=e||a*r,c=e||i*r,l=S.useMemo((()=>{const e=new n.DepthTexture(s,c);return e.format=n.DepthFormat,e.type=n.UnsignedShortType,{depthTexture:e}}),[s,c]);let u=0;const d=ur(s,c,l);return o.useFrame((e=>{(t===1/0||u<t)&&(e.gl.setRenderTarget(d),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),u++)})),d.depthTexture},exports.useDetectGPU=e=>m.suspend((()=>x.getGPUTier(e)),["useDetectGPU"]),exports.useEnvironment=nn,exports.useFBO=ur,exports.useFBX=nr,exports.useGLTF=ir,exports.useGizmoContext=Ft,exports.useHelper=function(e,t,...r){const n=S.useRef(),a=o.useThree((e=>e.scene));return S.useEffect((()=>(e&&t&&null!=e&&e.current&&(n.current=new t(e.current,...r),n.current&&a.add(n.current)),!e&&n.current&&a.remove(n.current),()=>{n.current&&a.remove(n.current)})),[a,t,e,...r]),o.useFrame((()=>{var e;null!=(e=n.current)&&e.update&&n.current.update()})),n},exports.useIntersect=function(e){const t=S.useRef(null),r=S.useRef(!1),n=S.useRef(!1);return S.useEffect((()=>{const a=t.current;if(a){const t=o.addEffect((()=>(r.current=!1,!0))),i=a.onBeforeRender;a.onBeforeRender=()=>r.current=!0;const s=o.addAfterEffect((()=>(r.current!==n.current&&e(n.current=r.current),!0)));return()=>{a.onBeforeRender=i,t(),s()}}}),[]),t},exports.useKTX2=cr,exports.useMask=function(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?T.NotEqualStencilFunc:T.EqualStencilFunc,stencilFail:T.KeepStencilOp,stencilZFail:T.KeepStencilOp,stencilZPass:T.KeepStencilOp}},exports.useMatcapTexture=function(e=0,t=1024,r){const n=m.suspend((()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then((e=>e.json()))),["matcapList"]),o=n[0],a=S.useMemo((()=>Object.keys(n).length),[]),i=`${S.useMemo((()=>"string"==typeof e?e:"number"==typeof e?n[e]:null),[e])||o}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`,s=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${i}`;return[pe(s,r),s,a]},exports.useNormalTexture=function(e=0,t={},r){const{repeat:o=[1,1],anisotropy:a=1,offset:i=[0,0]}=t,s=m.suspend((()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then((e=>e.json()))),["normalsList"]),c=S.useMemo((()=>Object.keys(s).length),[]),l=s[0],u=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${s[e]||l}`,d=pe(u,r);return S.useLayoutEffect((()=>{d&&(d.wrapS=d.wrapT=n.RepeatWrapping,d.repeat=new n.Vector2(o[0],o[1]),d.offset=new n.Vector2(i[0],i[1]),d.anisotropy=a)}),[d,a,o,i]),[d,u,c]},exports.usePerformanceMonitor=function({onIncline:e,onDecline:r,onChange:n,onFallback:o}){const a=t.useContext(go),i=t.useRef({onIncline:e,onDecline:r,onChange:n,onFallback:o});t.useLayoutEffect((()=>{i.current.onIncline=e,i.current.onDecline=r,i.current.onChange=n,i.current.onFallback=o}),[e,r,n,o]),t.useLayoutEffect((()=>a.subscribe(i)),[a])},exports.useProgress=$,exports.useScroll=Y,exports.useSelect=function(){return S.useContext(ee)},exports.useSurfaceSampler=Se,exports.useTexture=pe,exports.useTrail=Me,exports.useVideoTexture=function(e,r){const{unsuspend:n,start:a,crossOrigin:i,muted:s,loop:c,...l}={unsuspend:"canplay",crossOrigin:"Anonymous",muted:!0,loop:!0,start:!0,...r},u=o.useThree((e=>e.gl)),d=m.suspend((()=>new Promise(((t,r)=>{const o=Object.assign(document.createElement("video"),{src:e,crossOrigin:i,loop:c,muted:s,...l}),a=new T.VideoTexture(o);a.encoding=u.outputEncoding,o.addEventListener(n,(()=>t(a)))}))),[e]);return t.useEffect((()=>{a&&d.image.play()}),[d]),d};
